!function(g){var I={};function C(A){if(I[A])return I[A].exports;var n=I[A]={i:A,l:!1,exports:{}};return g[A].call(n.exports,n,n.exports,C),n.l=!0,n.exports}C.m=g,C.c=I,C.d=function(g,I,A){C.o(g,I)||Object.defineProperty(g,I,{enumerable:!0,get:A})},C.r=function(g){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(g,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(g,"__esModule",{value:!0})},C.t=function(g,I){if(1&I&&(g=C(g)),8&I)return g;if(4&I&&"object"==typeof g&&g&&g.__esModule)return g;var A=Object.create(null);if(C.r(A),Object.defineProperty(A,"default",{enumerable:!0,value:g}),2&I&&"string"!=typeof g)for(var n in g)C.d(A,n,function(I){return g[I]}.bind(null,n));return A},C.n=function(g){var I=g&&g.__esModule?function(){return g.default}:function(){return g};return C.d(I,"a",I),I},C.o=function(g,I){return Object.prototype.hasOwnProperty.call(g,I)},C.p="",C(C.s=2)}([function(module,exports,__webpack_require__){"use strict";eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\nvar mapBoxUrl = exports.mapBoxUrl = 'https://gradska-sreda.dreamradio.org/map/styles/vs/{z}/{x}/{y}.png';\nvar mapBoxAttribution = exports.mapBoxAttribution = '&copy <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors';\n\nvar defaultMapSize = exports.defaultMapSize = {\n    areaHeight: 100, // Precents  // TODO take form MapInstance \n    areaWidth: 100 // Precents  // TODO take form MapInstance \n};\n\nvar defaultElConfig = exports.defaultElConfig = {\n    headerId: '#app-header',\n    elHeader: null\n};\n\nvar defaultObjectStyle = exports.defaultObjectStyle = {\n    color: \"#ff9710\",\n    opacity: 0.5,\n    width: 5,\n    mapActiveArea: {\n        position: 'absolute',\n        width: '100%',\n        height: '100%',\n        top: '0',\n        left: '0'\n    }\n};\n\nvar apiEndpoints = exports.apiEndpoints = {\n    geo: '/geo/'\n};//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMC5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy9hc3NldHMvZnJvbnQvanMvbWFwLWNvbmZpZy5qcz8xZGY3Il0sInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCBjb25zdCBtYXBCb3hVcmwgPSAnaHR0cHM6Ly9ncmFkc2thLXNyZWRhLmRyZWFtcmFkaW8ub3JnL21hcC9zdHlsZXMvdnMve3p9L3t4fS97eX0ucG5nJztcbmV4cG9ydCBjb25zdCBtYXBCb3hBdHRyaWJ1dGlvbiA9IGAmY29weSA8YSBocmVmPVwiaHR0cHM6Ly93d3cub3BlbnN0cmVldG1hcC5vcmcvY29weXJpZ2h0XCI+T3BlblN0cmVldE1hcDwvYT4gY29udHJpYnV0b3JzYDtcblxuZXhwb3J0IGNvbnN0IGRlZmF1bHRNYXBTaXplID0ge1xuICAgIGFyZWFIZWlnaHQ6IDEwMCwgLy8gUHJlY2VudHMgIC8vIFRPRE8gdGFrZSBmb3JtIE1hcEluc3RhbmNlIFxuICAgIGFyZWFXaWR0aDogMTAwLCAvLyBQcmVjZW50cyAgLy8gVE9ETyB0YWtlIGZvcm0gTWFwSW5zdGFuY2UgXG59O1xuXG5leHBvcnQgY29uc3QgZGVmYXVsdEVsQ29uZmlnID0ge1xuICAgIGhlYWRlcklkOiAnI2FwcC1oZWFkZXInLFxuICAgIGVsSGVhZGVyOiBudWxsLFxufTtcblxuZXhwb3J0IGNvbnN0IGRlZmF1bHRPYmplY3RTdHlsZSA9IHtcbiAgICBjb2xvcjogXCIjZmY5NzEwXCIsXG4gICAgb3BhY2l0eTogMC41LFxuICAgIHdpZHRoOiA1LFxuICAgIG1hcEFjdGl2ZUFyZWE6IHtcbiAgICAgICAgcG9zaXRpb246ICdhYnNvbHV0ZScsXG4gICAgICAgIHdpZHRoOiAnMTAwJScsXG4gICAgICAgIGhlaWdodDogJzEwMCUnLFxuICAgICAgICB0b3A6ICcwJyxcbiAgICAgICAgbGVmdDogJzAnLFxuICAgIH1cbn07XG5cbmV4cG9ydCBjb25zdCBhcGlFbmRwb2ludHMgPSB7XG4gICAgZ2VvOiAnL2dlby8nXG59O1xuXG5cbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFGQTtBQUNBO0FBSUE7QUFDQTtBQUNBO0FBRkE7QUFDQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBTEE7QUFKQTtBQUNBO0FBWUE7QUFDQTtBQURBIiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///0\n")},function(module,exports,__webpack_require__){"use strict";eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\nexports.Collections = exports.Collection = undefined;\n\nvar _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _mapConfig = __webpack_require__(0);\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar Collection = exports.Collection = function () {\n    function Collection(mapInstance, settings) {\n        var _this = this;\n\n        _classCallCheck(this, Collection);\n\n        this.mapInstance = mapInstance;\n        this.settings = settings;\n\n        this.layer = L.geoJSON([], {\n            style: function style(feature) {\n                var styles = settings.styles[feature.properties._s1] ? _extends({}, settings.styles[feature.properties._s1]) : _extends({}, defaultObjectStyle);\n                return styles;\n            },\n            onEachFeature: function onEachFeature(feature, layer) {\n                layer.on('click', function (ev) {\n                    console.log('Collections - LayerGeoJson - CLICK');\n                    _this.onLayerClick(layer, ev);\n                    _this.mapInstance.zoomToLayer(layer, ev);\n                });\n                layer.on('mouseover', function () {\n                    if (layer.feature.properties.activePopup) {\n                        return;\n                    }\n                    if (settings.styles[feature.properties._s2]) {\n                        _this.setLayerHoverStyle(layer);\n                    }\n                });\n                layer.on('mouseout', function () {\n                    if (layer.feature.properties.activePopup || _this.activeLayer === layer) {\n                        return;\n                    }\n                    if (settings.styles[feature.properties._s1]) {\n                        _this.setLayerDefaultStyle(layer);\n                    }\n                });\n            },\n            pointToLayer: function pointToLayer(feature, latlng) {\n                return L.circleMarker(latlng, settings.styles[feature.properties._s1]);\n            }\n        });\n    }\n\n    _createClass(Collection, [{\n        key: 'setLayerDefaultStyle',\n        value: function setLayerDefaultStyle(layer) {\n            layer.setStyle(this.settings.styles[layer.feature.properties._s1] || defaultObjectStyle);\n        }\n    }, {\n        key: 'setLayerHoverStyle',\n        value: function setLayerHoverStyle(layer) {\n            layer.setStyle(this.settings.styles[layer.feature.properties._s2]);\n        }\n    }, {\n        key: 'onLayerClick',\n        value: function onLayerClick(layer, ev) {\n            this.mapInstance.onLayerClick(layer, ev);\n            // TODO: Remove if not needed\n            //     layer.feature.properties.activePopup = true;\n            //     this.mapInstance.setLayerActiveStyle(layer);\n            //     this.mapInstance.removeAllPopups();\n            //     console.log('s------');\n\n            //    console.log(layer.feature.properties._behavior);\n\n            //     if (layer.feature.properties._behavior === 'survey') {\n            //         if (this.isCollectionsActive) {\n            //             this.add(layer, ev);\n            //         }\n            //     }\n        }\n    }]);\n\n    return Collection;\n}();\n\nvar Collections = exports.Collections = function () {\n    _createClass(Collections, [{\n        key: 'isCollectionsActive',\n        get: function get() {\n            return this.mapInstance.map.hasLayer(this.mapInstance.mapResponse.CollectionsLayerControl);\n        }\n    }]);\n\n    function Collections(mapInstance) {\n        _classCallCheck(this, Collections);\n\n        this.isCollectionShown = false;\n\n        this.mapInstance = mapInstance;\n        this.init();\n        this.events();\n    }\n\n    _createClass(Collections, [{\n        key: 'init',\n        value: function init() {\n            this.elCollectionsContainer = document.getElementById('collections');\n            this.elCollectionsList = this.elCollectionsContainer.querySelector('#collections-list');\n            this.getGeoCollectionsList();\n        }\n    }, {\n        key: 'events',\n        value: function events() {\n            var _this2 = this;\n\n            // document.getElementById('collections-toggle').checked = this.isCollectionsActive;\n\n            $(document).on('click', '#collections-toggle', function () {\n                _this2.toggleCollectionLayer();\n            });\n\n            $(document).on('click', '[data-collection-id]', function (e) {\n                e.preventDefault();\n                $('[data-collection-id]').removeClass('active');\n                e.currentTarget.classList.add('active');\n                var collectionId = e.currentTarget.getAttribute('data-collection-id');\n                _this2.setActiveCollection(collectionId);\n            });\n\n            $(document).on('click', '[data-toggle-for=\"collections\"][data-toggle-open]', function () {\n                _this2.open();\n            });\n\n            $(document).on('click', '[data-toggle-for=\"collections\"][data-toggle-close]', function () {\n                _this2.close();\n            });\n\n            $(document).on('click', '#collections .remove', function (e) {\n                var uuid = e.currentTarget.getAttribute('data-uuid');\n                _this2.delete(uuid);\n            });\n\n            $(document).on('click', '#collections .add', function (e) {\n                _this2.new();\n            });\n\n            this.mapInstance.toggleHeaderEl(true);\n        }\n    }, {\n        key: 'toggleCollectionLayer',\n        value: function toggleCollectionLayer(toggle) {\n            if (!this.isCollectionShown) {\n                // TODO: Remove this if not needed\n                // this.mapInstance.map.removeLayer(this.mapInstance.mapResponse.CollectionsLayerGeoJson);\n                this.open();\n            } else {\n                // this.mapInstance.mapResponse.CollectionsLayerGeoJson.addTo(this.mapInstance.map);\n                this.close();\n            }\n        }\n    }, {\n        key: 'add',\n        value: function add(layer) {\n            var _this3 = this;\n\n            if (typeof this.activeCollectionId !== 'undefined') {\n                this.getGeoCollectionsList();\n\n                $.ajax({\n                    type: 'POST',\n                    url: '/front-end/geo-collection/add',\n                    data: {\n                        'geo-object': layer.feature.properties.id,\n                        'collection': this.activeCollectionId\n                    },\n                    success: function success() {\n                        var center = _this3.mapInstance.map.getCenter();\n                        _this3.mapInstance.updateMap(center);\n                    }\n                });\n            }\n        }\n    }, {\n        key: 'delete',\n        value: function _delete(layerUUID) {\n            var _this4 = this;\n\n            var layer = this.mapInstance.mapResponse.CollectionsLayerControl.getLayer(layerUUID);\n\n            $.ajax({\n                type: 'DELETE',\n                url: '/front-end/geo-collection/' + layerUUID,\n                success: function success() {\n                    _this4.getGeoCollectionsList();\n                    _this4.mapInstance.mapResponse.CollectionsLayerControl.removeLayer(layer);\n                }\n            });\n        }\n    }, {\n        key: 'new',\n        value: function _new() {\n            var _this5 = this;\n\n            $.ajax({\n                type: 'POST',\n                url: '/front-end/geo-collection/new',\n                success: function success(response) {\n                    _this5.activeCollectionId = response.id;\n                    _this5.getGeoCollectionsList();\n                }\n            });\n        }\n    }, {\n        key: 'setActiveCollection',\n        value: function setActiveCollection(activeCollectionId) {\n            var _this6 = this;\n\n            this.activeCollectionId = activeCollectionId;\n            var activeCollection = this.collectionsResponse.find(function (geoLocation) {\n                return geoLocation.id === _this6.activeCollectionId;\n            });\n            var layer = this.mapInstance.mapResponse.CollectionsLayerControl.getLayer(activeCollectionId);\n\n            if (layer) {\n                if (!this.mapInstance.map.getBounds().contains(layer.getBounds())) {\n                    this.mapInstance.map.fitBounds(layer.getBounds());\n                }\n\n                this.mapInstance.zoomToLayer(null, null, layer.getBounds().getCenter());\n            }\n        }\n    }, {\n        key: 'unsetActiveCollection',\n        value: function unsetActiveCollection() {\n            $('[data-collection-id]').removeClass('active;');\n            this.activeCollectionId = null;\n        }\n    }, {\n        key: 'getGeoCollectionsList',\n        value: function getGeoCollectionsList() {\n            // $.ajax({\n            //     url: '/front-end/geo-collection/info',\n            //     success: result => {\n            //         this.collectionsResponse = result;\n            //         let html = `<ul class=\"collections-list mt-4 pl-4\">`;\n            //\n            //         this.collectionsResponse.forEach(geoLocation => {\n            //             html += `<li class=\"collections-list-item mb-2\">`;\n            //             html += `\n            //                 <div class=\"d-flex\">\n            //                     <a class=\"collections-list-item-link font-weight-bold ${this.activeCollectionId === geoLocation.id ? 'active' : null}\" data-collection-id=\"${geoLocation.id}\" href=\"#${geoLocation.id}\">\n            //                         ${geoLocation.name ? geoLocation.name : 'Маршрут ' +  geoLocation.identify} <span class=\"is-active\">[<span class=\"text-success\">активен</span>]</span>\n            //                     </a>\n            //                     <span class=\"d-flex justify-content-end flex-grow-1\">\n            //                         <button data-uuid=\"${geoLocation.id}\" class=\"remove btn btn-sm btn-danger\">\n            //                             <i class=\"fa fa-trash\"></i>\n            //                         </button>\n            //                     </span>\n            //                 </div>\n            //             `;\n            //\n            //             html += `\n            //                 <div>\n            // \t\t\t\t\tдължина: ${geoLocation.length} м<br />\n            // \t\t\t\t\tоценен: ${geoLocation.completion.percentage} %<br />\n            // \t\t\t\t\t\t<div class=\"progress\" style=\"height: 3px;\">\n            // \t\t\t\t\t\t\t<div class=\"progress-bar\" role=\"progressbar\" style=\"width: ${geoLocation.completion.percentage}%;\" aria-valuenow=\"25\" aria-valuemin=\"0\" aria-valuemax=\"100\"></div>\n            //                         </div>\n            //                 </div>\n            //             `;\n            //\n            //             html +=\t`</li>`;\n            //         });\n            //\n            //         html += `</ul>`;\n            //\n            //         this.elCollectionsList.innerHTML = html;\n            //     }\n            // });\n        }\n    }, {\n        key: 'open',\n        value: function open() {\n            this.mapInstance.map.closePopup();\n            this.mapInstance.toggleHeaderEl(false);\n\n            this.isCollectionShown = true;\n            this.elCollectionsContainer.classList.add('active');\n\n            this.mapInstance.addToActiveAreaList(this.elCollectionsContainer);\n        }\n    }, {\n        key: 'close',\n        value: function close() {\n            this.mapInstance.toggleHeaderEl(true);\n            this.isCollectionShown = false;\n            this.elCollectionsContainer.classList.remove('active');\n\n            this.mapInstance.removeFromActiveAreaList(this.elCollectionsContainer);\n        }\n    }]);\n\n    return Collections;\n}();//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMS5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy9hc3NldHMvZnJvbnQvanMvY29sbGVjdGlvbnMuanM/NDNlNyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBkZWZhdWx0TWFwU2l6ZSB9IGZyb20gJy4vbWFwLWNvbmZpZyc7XG5cbmV4cG9ydCBjbGFzcyBDb2xsZWN0aW9uIHtcblxuICAgIGNvbnN0cnVjdG9yKG1hcEluc3RhbmNlLCBzZXR0aW5ncykge1xuICAgICAgICB0aGlzLm1hcEluc3RhbmNlID0gbWFwSW5zdGFuY2U7XG4gICAgICAgIHRoaXMuc2V0dGluZ3MgPSBzZXR0aW5ncztcblxuICAgICAgICB0aGlzLmxheWVyID0gTC5nZW9KU09OKFtdLCB7XG4gICAgICAgICAgICBzdHlsZTogKGZlYXR1cmUpID0+IHtcbiAgICAgICAgICAgICAgICBsZXQgc3R5bGVzID0gc2V0dGluZ3Muc3R5bGVzW2ZlYXR1cmUucHJvcGVydGllcy5fczFdID8gey4uLnNldHRpbmdzLnN0eWxlc1tmZWF0dXJlLnByb3BlcnRpZXMuX3MxXX0gOiB7Li4uZGVmYXVsdE9iamVjdFN0eWxlfTtcbiAgICAgICAgICAgICAgICByZXR1cm4gc3R5bGVzO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG9uRWFjaEZlYXR1cmU6IChmZWF0dXJlLCBsYXllcikgPT4ge1xuICAgICAgICAgICAgICAgIGxheWVyLm9uKCdjbGljaycsIChldikgPT4ge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnQ29sbGVjdGlvbnMgLSBMYXllckdlb0pzb24gLSBDTElDSycpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLm9uTGF5ZXJDbGljayhsYXllciwgZXYpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLm1hcEluc3RhbmNlLnpvb21Ub0xheWVyKGxheWVyLCBldik7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgbGF5ZXIub24oJ21vdXNlb3ZlcicsICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGxheWVyLmZlYXR1cmUucHJvcGVydGllcy5hY3RpdmVQb3B1cCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmIChzZXR0aW5ncy5zdHlsZXNbZmVhdHVyZS5wcm9wZXJ0aWVzLl9zMl0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0TGF5ZXJIb3ZlclN0eWxlKGxheWVyKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGxheWVyLm9uKCdtb3VzZW91dCcsICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGxheWVyLmZlYXR1cmUucHJvcGVydGllcy5hY3RpdmVQb3B1cCB8fCB0aGlzLmFjdGl2ZUxheWVyID09PSBsYXllcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmIChzZXR0aW5ncy5zdHlsZXNbZmVhdHVyZS5wcm9wZXJ0aWVzLl9zMV0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0TGF5ZXJEZWZhdWx0U3R5bGUobGF5ZXIpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcG9pbnRUb0xheWVyOiAoZmVhdHVyZSwgbGF0bG5nKSA9PiB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIEwuY2lyY2xlTWFya2VyKGxhdGxuZywgc2V0dGluZ3Muc3R5bGVzW2ZlYXR1cmUucHJvcGVydGllcy5fczFdKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgc2V0TGF5ZXJEZWZhdWx0U3R5bGUobGF5ZXIpIHtcbiAgICAgICAgbGF5ZXIuc2V0U3R5bGUodGhpcy5zZXR0aW5ncy5zdHlsZXNbbGF5ZXIuZmVhdHVyZS5wcm9wZXJ0aWVzLl9zMV0gfHwgZGVmYXVsdE9iamVjdFN0eWxlKVxuICAgIH1cblxuICAgIHNldExheWVySG92ZXJTdHlsZShsYXllcikge1xuICAgICAgICBsYXllci5zZXRTdHlsZSh0aGlzLnNldHRpbmdzLnN0eWxlc1tsYXllci5mZWF0dXJlLnByb3BlcnRpZXMuX3MyXSlcbiAgICB9XG5cbiAgICBvbkxheWVyQ2xpY2sobGF5ZXIsIGV2KSB7XG4gICAgICAgIHRoaXMubWFwSW5zdGFuY2Uub25MYXllckNsaWNrKGxheWVyLCBldik7XG4gICAgLy8gVE9ETzogUmVtb3ZlIGlmIG5vdCBuZWVkZWRcbiAgICAvLyAgICAgbGF5ZXIuZmVhdHVyZS5wcm9wZXJ0aWVzLmFjdGl2ZVBvcHVwID0gdHJ1ZTtcbiAgICAvLyAgICAgdGhpcy5tYXBJbnN0YW5jZS5zZXRMYXllckFjdGl2ZVN0eWxlKGxheWVyKTtcbiAgICAvLyAgICAgdGhpcy5tYXBJbnN0YW5jZS5yZW1vdmVBbGxQb3B1cHMoKTtcbiAgICAvLyAgICAgY29uc29sZS5sb2coJ3MtLS0tLS0nKTtcblxuICAgIC8vICAgIGNvbnNvbGUubG9nKGxheWVyLmZlYXR1cmUucHJvcGVydGllcy5fYmVoYXZpb3IpO1xuXG4gICAgLy8gICAgIGlmIChsYXllci5mZWF0dXJlLnByb3BlcnRpZXMuX2JlaGF2aW9yID09PSAnc3VydmV5Jykge1xuICAgIC8vICAgICAgICAgaWYgKHRoaXMuaXNDb2xsZWN0aW9uc0FjdGl2ZSkge1xuICAgIC8vICAgICAgICAgICAgIHRoaXMuYWRkKGxheWVyLCBldik7XG4gICAgLy8gICAgICAgICB9XG4gICAgLy8gICAgIH1cbiAgICB9XG59XG5cbmV4cG9ydCBjbGFzcyBDb2xsZWN0aW9ucyB7XG4gICAgbWFwSW5zdGFuY2U7XG4gICAgYWN0aXZlQ29sbGVjdGlvbklkO1xuICAgIGVsQ29sbGVjdGlvbnNDb250YWluZXI7XG4gICAgZWxDb2xsZWN0aW9uc0xpc3Q7XG4gICAgaXNDb2xsZWN0aW9uU2hvd24gPSBmYWxzZTtcbiAgICBjb2xsZWN0aW9uc1Jlc3BvbnNlO1xuICAgIGdldCBpc0NvbGxlY3Rpb25zQWN0aXZlKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5tYXBJbnN0YW5jZS5tYXAuaGFzTGF5ZXIodGhpcy5tYXBJbnN0YW5jZS5tYXBSZXNwb25zZS5Db2xsZWN0aW9uc0xheWVyQ29udHJvbCk7XG4gICAgfVxuXG4gICAgY29uc3RydWN0b3IobWFwSW5zdGFuY2UpIHtcbiAgICAgICAgdGhpcy5tYXBJbnN0YW5jZSA9IG1hcEluc3RhbmNlO1xuICAgICAgICB0aGlzLmluaXQoKTtcbiAgICAgICAgdGhpcy5ldmVudHMoKTtcbiAgICB9XG5cbiAgICBpbml0KCkge1xuICAgICAgICB0aGlzLmVsQ29sbGVjdGlvbnNDb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY29sbGVjdGlvbnMnKTtcbiAgICAgICAgdGhpcy5lbENvbGxlY3Rpb25zTGlzdCA9IHRoaXMuZWxDb2xsZWN0aW9uc0NvbnRhaW5lci5xdWVyeVNlbGVjdG9yKCcjY29sbGVjdGlvbnMtbGlzdCcpO1xuICAgICAgICB0aGlzLmdldEdlb0NvbGxlY3Rpb25zTGlzdCgpO1xuICAgIH1cblxuICAgIGV2ZW50cygpIHtcbiAgICAgICAgLy8gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbGxlY3Rpb25zLXRvZ2dsZScpLmNoZWNrZWQgPSB0aGlzLmlzQ29sbGVjdGlvbnNBY3RpdmU7XG5cbiAgICAgICAgJChkb2N1bWVudCkub24oJ2NsaWNrJywgJyNjb2xsZWN0aW9ucy10b2dnbGUnLCAoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLnRvZ2dsZUNvbGxlY3Rpb25MYXllcigpO1xuICAgICAgICB9KTtcblxuICAgICAgICAkKGRvY3VtZW50KS5vbignY2xpY2snLCAnW2RhdGEtY29sbGVjdGlvbi1pZF0nLCAoZSkgPT4ge1xuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgJCgnW2RhdGEtY29sbGVjdGlvbi1pZF0nKS5yZW1vdmVDbGFzcygnYWN0aXZlJyk7XG4gICAgICAgICAgICBlLmN1cnJlbnRUYXJnZXQuY2xhc3NMaXN0LmFkZCgnYWN0aXZlJyk7XG4gICAgICAgICAgICBjb25zdCBjb2xsZWN0aW9uSWQgPSBlLmN1cnJlbnRUYXJnZXQuZ2V0QXR0cmlidXRlKCdkYXRhLWNvbGxlY3Rpb24taWQnKTtcbiAgICAgICAgICAgIHRoaXMuc2V0QWN0aXZlQ29sbGVjdGlvbihjb2xsZWN0aW9uSWQpO1xuICAgICAgICB9KVxuXG4gICAgICAgICQoZG9jdW1lbnQpLm9uKCdjbGljaycsICdbZGF0YS10b2dnbGUtZm9yPVwiY29sbGVjdGlvbnNcIl1bZGF0YS10b2dnbGUtb3Blbl0nLCAoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLm9wZW4oKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgJChkb2N1bWVudCkub24oJ2NsaWNrJywgJ1tkYXRhLXRvZ2dsZS1mb3I9XCJjb2xsZWN0aW9uc1wiXVtkYXRhLXRvZ2dsZS1jbG9zZV0nLCAoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmNsb3NlKCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgICQoZG9jdW1lbnQpLm9uKCdjbGljaycsICcjY29sbGVjdGlvbnMgLnJlbW92ZScsIChlKSA9PiB7XG4gICAgICAgICAgICBjb25zdCB1dWlkID0gZS5jdXJyZW50VGFyZ2V0LmdldEF0dHJpYnV0ZSgnZGF0YS11dWlkJyk7XG4gICAgICAgICAgICB0aGlzLmRlbGV0ZSh1dWlkKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgJChkb2N1bWVudCkub24oJ2NsaWNrJywgJyNjb2xsZWN0aW9ucyAuYWRkJywgKGUpID0+IHtcbiAgICAgICAgICAgIHRoaXMubmV3KCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRoaXMubWFwSW5zdGFuY2UudG9nZ2xlSGVhZGVyRWwodHJ1ZSk7XG4gICAgfVxuXG4gICAgdG9nZ2xlQ29sbGVjdGlvbkxheWVyKHRvZ2dsZSkge1xuICAgICAgICBpZiAoIXRoaXMuaXNDb2xsZWN0aW9uU2hvd24pIHtcbiAgICAgICAgICAgIC8vIFRPRE86IFJlbW92ZSB0aGlzIGlmIG5vdCBuZWVkZWRcbiAgICAgICAgICAgIC8vIHRoaXMubWFwSW5zdGFuY2UubWFwLnJlbW92ZUxheWVyKHRoaXMubWFwSW5zdGFuY2UubWFwUmVzcG9uc2UuQ29sbGVjdGlvbnNMYXllckdlb0pzb24pO1xuICAgICAgICAgICAgdGhpcy5vcGVuKCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvLyB0aGlzLm1hcEluc3RhbmNlLm1hcFJlc3BvbnNlLkNvbGxlY3Rpb25zTGF5ZXJHZW9Kc29uLmFkZFRvKHRoaXMubWFwSW5zdGFuY2UubWFwKTtcbiAgICAgICAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGFkZChsYXllcikge1xuICAgICAgICBpZiAodHlwZW9mIHRoaXMuYWN0aXZlQ29sbGVjdGlvbklkICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgdGhpcy5nZXRHZW9Db2xsZWN0aW9uc0xpc3QoKTtcblxuICAgICAgICAgICAgJC5hamF4KHtcbiAgICAgICAgICAgICAgICB0eXBlOiAnUE9TVCcsXG4gICAgICAgICAgICAgICAgdXJsOiAnL2Zyb250LWVuZC9nZW8tY29sbGVjdGlvbi9hZGQnLFxuICAgICAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICAgICAgJ2dlby1vYmplY3QnOiBsYXllci5mZWF0dXJlLnByb3BlcnRpZXMuaWQsXG4gICAgICAgICAgICAgICAgICAgICdjb2xsZWN0aW9uJzogdGhpcy5hY3RpdmVDb2xsZWN0aW9uSWRcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6ICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgY2VudGVyID0gdGhpcy5tYXBJbnN0YW5jZS5tYXAuZ2V0Q2VudGVyKCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubWFwSW5zdGFuY2UudXBkYXRlTWFwKGNlbnRlcik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBkZWxldGUobGF5ZXJVVUlEKSB7XG4gICAgICAgIGNvbnN0IGxheWVyID0gdGhpcy5tYXBJbnN0YW5jZS5tYXBSZXNwb25zZS5Db2xsZWN0aW9uc0xheWVyQ29udHJvbC5nZXRMYXllcihsYXllclVVSUQpO1xuXG4gICAgICAgICQuYWpheCh7XG4gICAgICAgICAgICB0eXBlOiAnREVMRVRFJyxcbiAgICAgICAgICAgIHVybDogYC9mcm9udC1lbmQvZ2VvLWNvbGxlY3Rpb24vJHtsYXllclVVSUR9YCxcbiAgICAgICAgICAgIHN1Y2Nlc3M6ICgpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmdldEdlb0NvbGxlY3Rpb25zTGlzdCgpO1xuICAgICAgICAgICAgICAgIHRoaXMubWFwSW5zdGFuY2UubWFwUmVzcG9uc2UuQ29sbGVjdGlvbnNMYXllckNvbnRyb2wucmVtb3ZlTGF5ZXIobGF5ZXIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBuZXcoKSB7XG4gICAgICAgICQuYWpheCh7XG4gICAgICAgICAgICB0eXBlOiAnUE9TVCcsXG4gICAgICAgICAgICB1cmw6ICcvZnJvbnQtZW5kL2dlby1jb2xsZWN0aW9uL25ldycsXG4gICAgICAgICAgICBzdWNjZXNzOiAocmVzcG9uc2UpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmFjdGl2ZUNvbGxlY3Rpb25JZCA9IHJlc3BvbnNlLmlkO1xuICAgICAgICAgICAgICAgIHRoaXMuZ2V0R2VvQ29sbGVjdGlvbnNMaXN0KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHNldEFjdGl2ZUNvbGxlY3Rpb24oYWN0aXZlQ29sbGVjdGlvbklkKSB7XG4gICAgICAgIHRoaXMuYWN0aXZlQ29sbGVjdGlvbklkID0gYWN0aXZlQ29sbGVjdGlvbklkO1xuICAgICAgICBjb25zdCBhY3RpdmVDb2xsZWN0aW9uID0gdGhpcy5jb2xsZWN0aW9uc1Jlc3BvbnNlLmZpbmQoZ2VvTG9jYXRpb24gPT4gZ2VvTG9jYXRpb24uaWQgPT09IHRoaXMuYWN0aXZlQ29sbGVjdGlvbklkKTtcbiAgICAgICAgY29uc3QgbGF5ZXIgPSB0aGlzLm1hcEluc3RhbmNlLm1hcFJlc3BvbnNlLkNvbGxlY3Rpb25zTGF5ZXJDb250cm9sLmdldExheWVyKGFjdGl2ZUNvbGxlY3Rpb25JZCk7XG5cbiAgICAgICAgaWYgKGxheWVyKSB7XG4gICAgICAgICAgICBpZiAoIXRoaXMubWFwSW5zdGFuY2UubWFwLmdldEJvdW5kcygpLmNvbnRhaW5zKGxheWVyLmdldEJvdW5kcygpKSkge1xuICAgICAgICAgICAgICAgIHRoaXMubWFwSW5zdGFuY2UubWFwLmZpdEJvdW5kcyhsYXllci5nZXRCb3VuZHMoKSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMubWFwSW5zdGFuY2Uuem9vbVRvTGF5ZXIobnVsbCwgbnVsbCwgbGF5ZXIuZ2V0Qm91bmRzKCkuZ2V0Q2VudGVyKCkpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgdW5zZXRBY3RpdmVDb2xsZWN0aW9uKCkge1xuICAgICAgICAkKCdbZGF0YS1jb2xsZWN0aW9uLWlkXScpLnJlbW92ZUNsYXNzKCdhY3RpdmU7JylcbiAgICAgICAgdGhpcy5hY3RpdmVDb2xsZWN0aW9uSWQgPSBudWxsO1xuICAgIH1cblxuICAgIGdldEdlb0NvbGxlY3Rpb25zTGlzdCgpIHtcbiAgICAgICAgLy8gJC5hamF4KHtcbiAgICAgICAgLy8gICAgIHVybDogJy9mcm9udC1lbmQvZ2VvLWNvbGxlY3Rpb24vaW5mbycsXG4gICAgICAgIC8vICAgICBzdWNjZXNzOiByZXN1bHQgPT4ge1xuICAgICAgICAvLyAgICAgICAgIHRoaXMuY29sbGVjdGlvbnNSZXNwb25zZSA9IHJlc3VsdDtcbiAgICAgICAgLy8gICAgICAgICBsZXQgaHRtbCA9IGA8dWwgY2xhc3M9XCJjb2xsZWN0aW9ucy1saXN0IG10LTQgcGwtNFwiPmA7XG4gICAgICAgIC8vXG4gICAgICAgIC8vICAgICAgICAgdGhpcy5jb2xsZWN0aW9uc1Jlc3BvbnNlLmZvckVhY2goZ2VvTG9jYXRpb24gPT4ge1xuICAgICAgICAvLyAgICAgICAgICAgICBodG1sICs9IGA8bGkgY2xhc3M9XCJjb2xsZWN0aW9ucy1saXN0LWl0ZW0gbWItMlwiPmA7XG4gICAgICAgIC8vICAgICAgICAgICAgIGh0bWwgKz0gYFxuICAgICAgICAvLyAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cImQtZmxleFwiPlxuICAgICAgICAvLyAgICAgICAgICAgICAgICAgICAgIDxhIGNsYXNzPVwiY29sbGVjdGlvbnMtbGlzdC1pdGVtLWxpbmsgZm9udC13ZWlnaHQtYm9sZCAke3RoaXMuYWN0aXZlQ29sbGVjdGlvbklkID09PSBnZW9Mb2NhdGlvbi5pZCA/ICdhY3RpdmUnIDogbnVsbH1cIiBkYXRhLWNvbGxlY3Rpb24taWQ9XCIke2dlb0xvY2F0aW9uLmlkfVwiIGhyZWY9XCIjJHtnZW9Mb2NhdGlvbi5pZH1cIj5cbiAgICAgICAgLy8gICAgICAgICAgICAgICAgICAgICAgICAgJHtnZW9Mb2NhdGlvbi5uYW1lID8gZ2VvTG9jYXRpb24ubmFtZSA6ICfQnNCw0YDRiNGA0YPRgiAnICsgIGdlb0xvY2F0aW9uLmlkZW50aWZ5fSA8c3BhbiBjbGFzcz1cImlzLWFjdGl2ZVwiPls8c3BhbiBjbGFzcz1cInRleHQtc3VjY2Vzc1wiPtCw0LrRgtC40LLQtdC9PC9zcGFuPl08L3NwYW4+XG4gICAgICAgIC8vICAgICAgICAgICAgICAgICAgICAgPC9hPlxuICAgICAgICAvLyAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPVwiZC1mbGV4IGp1c3RpZnktY29udGVudC1lbmQgZmxleC1ncm93LTFcIj5cbiAgICAgICAgLy8gICAgICAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBkYXRhLXV1aWQ9XCIke2dlb0xvY2F0aW9uLmlkfVwiIGNsYXNzPVwicmVtb3ZlIGJ0biBidG4tc20gYnRuLWRhbmdlclwiPlxuICAgICAgICAvLyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGkgY2xhc3M9XCJmYSBmYS10cmFzaFwiPjwvaT5cbiAgICAgICAgLy8gICAgICAgICAgICAgICAgICAgICAgICAgPC9idXR0b24+XG4gICAgICAgIC8vICAgICAgICAgICAgICAgICAgICAgPC9zcGFuPlxuICAgICAgICAvLyAgICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgIC8vICAgICAgICAgICAgIGA7XG4gICAgICAgIC8vXG4gICAgICAgIC8vICAgICAgICAgICAgIGh0bWwgKz0gYFxuICAgICAgICAvLyAgICAgICAgICAgICAgICAgPGRpdj5cblx0XHQvLyBcdFx0XHRcdFx00LTRitC70LbQuNC90LA6ICR7Z2VvTG9jYXRpb24ubGVuZ3RofSDQvDxiciAvPlxuXHRcdC8vIFx0XHRcdFx0XHTQvtGG0LXQvdC10L06ICR7Z2VvTG9jYXRpb24uY29tcGxldGlvbi5wZXJjZW50YWdlfSAlPGJyIC8+XG5cdFx0Ly8gXHRcdFx0XHRcdFx0PGRpdiBjbGFzcz1cInByb2dyZXNzXCIgc3R5bGU9XCJoZWlnaHQ6IDNweDtcIj5cblx0XHQvLyBcdFx0XHRcdFx0XHRcdDxkaXYgY2xhc3M9XCJwcm9ncmVzcy1iYXJcIiByb2xlPVwicHJvZ3Jlc3NiYXJcIiBzdHlsZT1cIndpZHRoOiAke2dlb0xvY2F0aW9uLmNvbXBsZXRpb24ucGVyY2VudGFnZX0lO1wiIGFyaWEtdmFsdWVub3c9XCIyNVwiIGFyaWEtdmFsdWVtaW49XCIwXCIgYXJpYS12YWx1ZW1heD1cIjEwMFwiPjwvZGl2PlxuICAgICAgICAvLyAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgLy8gICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAvLyAgICAgICAgICAgICBgO1xuICAgICAgICAvL1xuICAgICAgICAvLyAgICAgICAgICAgICBodG1sICs9XHRgPC9saT5gO1xuICAgICAgICAvLyAgICAgICAgIH0pO1xuICAgICAgICAvL1xuICAgICAgICAvLyAgICAgICAgIGh0bWwgKz0gYDwvdWw+YDtcbiAgICAgICAgLy9cbiAgICAgICAgLy8gICAgICAgICB0aGlzLmVsQ29sbGVjdGlvbnNMaXN0LmlubmVySFRNTCA9IGh0bWw7XG4gICAgICAgIC8vICAgICB9XG4gICAgICAgIC8vIH0pO1xuICAgIH1cblxuICAgIG9wZW4oKSB7XG4gICAgICAgIHRoaXMubWFwSW5zdGFuY2UubWFwLmNsb3NlUG9wdXAoKTtcbiAgICAgICAgdGhpcy5tYXBJbnN0YW5jZS50b2dnbGVIZWFkZXJFbChmYWxzZSk7XG5cbiAgICAgICAgdGhpcy5pc0NvbGxlY3Rpb25TaG93biA9IHRydWU7XG4gICAgICAgIHRoaXMuZWxDb2xsZWN0aW9uc0NvbnRhaW5lci5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTtcblxuICAgICAgICB0aGlzLm1hcEluc3RhbmNlLmFkZFRvQWN0aXZlQXJlYUxpc3QodGhpcy5lbENvbGxlY3Rpb25zQ29udGFpbmVyKTtcbiAgICB9XG5cbiAgICBjbG9zZSgpIHtcbiAgICAgICAgdGhpcy5tYXBJbnN0YW5jZS50b2dnbGVIZWFkZXJFbCh0cnVlKTtcbiAgICAgICAgdGhpcy5pc0NvbGxlY3Rpb25TaG93biA9IGZhbHNlO1xuICAgICAgICB0aGlzLmVsQ29sbGVjdGlvbnNDb250YWluZXIuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7XG5cbiAgICAgICAgdGhpcy5tYXBJbnN0YW5jZS5yZW1vdmVGcm9tQWN0aXZlQXJlYUxpc3QodGhpcy5lbENvbGxlY3Rpb25zQ29udGFpbmVyKTtcbiAgICB9XG59XG4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBQUE7QUFDQTs7O0FBQ0E7QUFFQTtBQUFBO0FBQ0E7QUFEQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUE5QkE7QUFnQ0E7QUFDQTs7O0FBQ0E7QUFDQTtBQUNBOzs7QUFFQTtBQUNBO0FBQ0E7OztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7QUFHQTs7O0FBT0E7QUFDQTtBQUNBOzs7QUFFQTtBQUFBO0FBQ0E7QUFEQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBRUE7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBRUE7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRkE7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQVZBO0FBWUE7QUFDQTs7O0FBRUE7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBTkE7QUFRQTs7O0FBRUE7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFOQTtBQVFBOzs7QUFFQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7OztBIiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///1\n")},function(module,exports,__webpack_require__){"use strict";eval("\n\n__webpack_require__(3);\n\nvar _mapMain = __webpack_require__(4);\n\nvar _survey = __webpack_require__(6);\n\nvar _collections = __webpack_require__(1);\n\n(function () {\n    $('[data-toggle=\"tooltip\"]').tooltip();\n\n    var mapInstance = new _mapMain.Map();\n    mapInstance.init();\n\n    var pathVoteSurvey = new _survey.Survey(mapInstance);\n    mapInstance.setSurvey(pathVoteSurvey);\n\n    var collctions = new _collections.Collections(mapInstance);\n    mapInstance.setCollection(collctions);\n\n    // window.addEventListener('hashchange', (e) => {\n    //     switch(window.location.hash) {\n    //         case '#collection':\n    //             mapInstance.setModeCollection();\n    //         break;\n    //         default: \n    //             mapInstance.setModeView();\n    //     }\n    // });\n})();//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMi5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy9hc3NldHMvZnJvbnQvanMvbWFpbi5qcz8zNzNhIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAnLi90b2dnbGUnO1xuaW1wb3J0IHsgTWFwIH0gZnJvbSAnLi9tYXAtbWFpbic7XG5pbXBvcnQgeyBTdXJ2ZXkgfSAgZnJvbSAnLi9zdXJ2ZXknO1xuaW1wb3J0IHsgQ29sbGVjdGlvbnMgfSBmcm9tICcuL2NvbGxlY3Rpb25zJztcblxuXG4oZnVuY3Rpb24oKSB7XG4gICAgJCgnW2RhdGEtdG9nZ2xlPVwidG9vbHRpcFwiXScpLnRvb2x0aXAoKTsgXG5cbiAgICBjb25zdCBtYXBJbnN0YW5jZSA9IG5ldyBNYXAoKTtcbiAgICBtYXBJbnN0YW5jZS5pbml0KCk7XG5cbiAgICBjb25zdCBwYXRoVm90ZVN1cnZleSA9IG5ldyBTdXJ2ZXkobWFwSW5zdGFuY2UpO1xuICAgIG1hcEluc3RhbmNlLnNldFN1cnZleShwYXRoVm90ZVN1cnZleSk7XG5cbiAgICBjb25zdCBjb2xsY3Rpb25zID0gbmV3IENvbGxlY3Rpb25zKG1hcEluc3RhbmNlKTtcbiAgICBtYXBJbnN0YW5jZS5zZXRDb2xsZWN0aW9uKGNvbGxjdGlvbnMpO1xuXG4gICAgLy8gd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2hhc2hjaGFuZ2UnLCAoZSkgPT4ge1xuICAgIC8vICAgICBzd2l0Y2god2luZG93LmxvY2F0aW9uLmhhc2gpIHtcbiAgICAvLyAgICAgICAgIGNhc2UgJyNjb2xsZWN0aW9uJzpcbiAgICAvLyAgICAgICAgICAgICBtYXBJbnN0YW5jZS5zZXRNb2RlQ29sbGVjdGlvbigpO1xuICAgIC8vICAgICAgICAgYnJlYWs7XG4gICAgLy8gICAgICAgICBkZWZhdWx0OiBcbiAgICAvLyAgICAgICAgICAgICBtYXBJbnN0YW5jZS5zZXRNb2RlVmlldygpO1xuICAgIC8vICAgICB9XG4gICAgLy8gfSk7XG4gfSkoKTtcblxuIl0sIm1hcHBpbmdzIjoiOztBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///2\n")},function(module,exports,__webpack_require__){"use strict";eval("\n\n$(document).on('click', '[data-toggle-open]', function (e) {\n    var targetToggleEl = document.getElementById(e.currentTarget.getAttribute('data-toggle-for'));\n\n    $('[data-toggle-type=\"' + targetToggleEl.getAttribute('data-toggle-type') + '\"]').removeClass('active');\n\n    targetToggleEl.classList.add('active');\n});\n\n$(document).on('click', '[data-toggle-close]', function (e) {\n    var targetToggleEl = document.getElementById(e.currentTarget.getAttribute('data-toggle-for'));\n    targetToggleEl.classList.remove('active');\n});//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMy5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy9hc3NldHMvZnJvbnQvanMvdG9nZ2xlLmpzP2NiOTciXSwic291cmNlc0NvbnRlbnQiOlsiJChkb2N1bWVudCkub24oJ2NsaWNrJywgJ1tkYXRhLXRvZ2dsZS1vcGVuXScsIChlKSA9PiB7XG4gICAgY29uc3QgdGFyZ2V0VG9nZ2xlRWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChlLmN1cnJlbnRUYXJnZXQuZ2V0QXR0cmlidXRlKCdkYXRhLXRvZ2dsZS1mb3InKSk7XG5cbiAgICAkKGBbZGF0YS10b2dnbGUtdHlwZT1cIiR7dGFyZ2V0VG9nZ2xlRWwuZ2V0QXR0cmlidXRlKCdkYXRhLXRvZ2dsZS10eXBlJyl9XCJdYCkucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpO1xuXG4gICAgdGFyZ2V0VG9nZ2xlRWwuY2xhc3NMaXN0LmFkZCgnYWN0aXZlJyk7XG59KTtcblxuJChkb2N1bWVudCkub24oJ2NsaWNrJywgJ1tkYXRhLXRvZ2dsZS1jbG9zZV0nLCAoZSkgPT4ge1xuICAgIGNvbnN0IHRhcmdldFRvZ2dsZUVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoZS5jdXJyZW50VGFyZ2V0LmdldEF0dHJpYnV0ZSgnZGF0YS10b2dnbGUtZm9yJykpO1xuICAgIHRhcmdldFRvZ2dsZUVsLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpO1xufSk7XG4iXSwibWFwcGluZ3MiOiI7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///3\n")},function(module,exports,__webpack_require__){"use strict";eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\nexports.Map = undefined;\n\nvar _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _mapConfig = __webpack_require__(0);\n\nvar _helpers = __webpack_require__(5);\n\nvar _collections = __webpack_require__(1);\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\n// import { defaultMapSize } from './map-config';\n\nvar Map = exports.Map = function () {\n    function Map() {\n        _classCallCheck(this, Map);\n\n        this.myLocationLayerGroup = L.layerGroup();\n        this.popusLayerGroup = L.layerGroup();\n        this.mapResponse = {\n            settings: {},\n            ObjectsLayerGeoJson: {},\n            CollectionsLayerControl: {},\n            SurveyResponses: {}\n        };\n        this.activeAreaList = [];\n        this.isMapLoaded = false;\n    }\n\n    _createClass(Map, [{\n        key: 'init',\n        value: function init() {\n            var _this = this;\n\n            this.initMap();\n            this.selectInitialElements();\n            this.events();\n            this.loading = $('.loading');\n            this.toggleHeaderEl(true);\n            //const mapCenter = mapOption.center;\n            //const mapZoom = mapOption.zoom;\n\n            var mapStyle = L.tileLayer(_mapConfig.mapBoxUrl, {\n                attribution: _mapConfig.mapBoxAttribution,\n                // * If difference between \"maxNativeZoom\" and \"maxZoom\" === 2\n                // and \"leafLet-active-area\" is included  \"Maximum call stack size exceeded\" is thrown on max zoom reached.\n                // https://github.com/Mappy/Leaflet-active-area/issues/32\n                maxNativeZoom: 20,\n                maxZoom: 21,\n                minZoom: 11,\n                updateWhenZooming: false\n            });\n            mapStyle.addTo(this.map);\n\n            var myLocationButton = L.Control.extend({\n                options: {\n                    position: 'topleft'\n                },\n                onAdd: function onAdd() {\n                    var container = L.DomUtil.create('button', 'leaflet-bar leaflet-control-custom far fa-dot-circle');\n                    container.type = 'button';\n                    container.onclick = function () {\n                        _this.locate();\n                    };\n                    return container;\n                }\n            });\n            this.map.addControl(new myLocationButton());\n\n            this.myLocationLayerGroup.addTo(this.map);\n\n            this.popusLayerGroup.addTo(this.map);\n\n            this.mapResponse.ObjectsLayerGeoJson = L.geoJSON([], {\n                style: function style(feature) {\n                    var styles = _this.mapResponse.settings.styles[feature.properties._s1] ? _extends({}, _this.mapResponse.settings.styles[feature.properties._s1]) : _extends({}, _mapConfig.defaultObjectStyle);\n                    return styles;\n                },\n                onEachFeature: function onEachFeature(feature, layer) {\n                    layer.on('click', function (ev) {\n                        console.log('Object LayerGeoJson CLICK');\n                        switch (feature.properties._behavior) {\n                            case 'navigation':\n                                _this.zoomToLayer(layer, ev);\n                                break;\n                            default:\n                                _this.onLayerClick(layer, ev);\n                                _this.zoomToLayer(layer, ev);\n                                break;\n                        }\n                    });\n                    layer.on('mouseover', function () {\n                        if (layer.feature.properties.activePopup) {\n                            return;\n                        }\n                        if (_this.mapResponse.settings.styles[feature.properties._s2]) {\n                            _this.setLayerHoverStyle(layer);\n                        }\n                    });\n                    layer.on('mouseout', function () {\n                        if (layer.feature.properties.activePopup || _this.activeLayer === layer) {\n                            return;\n                        }\n                        if (_this.mapResponse.settings.styles[feature.properties._s1]) {\n                            _this.setLayerDefaultStyle(layer);\n                        }\n                    });\n                },\n                pointToLayer: function pointToLayer(feature, latlng) {\n                    return L.circleMarker(latlng, _this.mapResponse.settings.styles[feature.properties._s1]);\n                }\n            }).addTo(this.map);\n\n            this.mapResponse.CollectionsLayerControl = L.layerGroup().addTo(this.map);\n\n            this.mapResponse.SurveyResponsesLayerGeoJson = L.geoJSON([], {\n                style: function style(feature) {\n                    var styles = _this.mapResponse.settings.styles[feature.properties._s1] ? _extends({}, _this.mapResponse.settings.styles[feature.properties._s1]) : _extends({}, _mapConfig.defaultObjectStyle);\n                    return styles;\n                },\n                onEachFeature: function onEachFeature(feature, layer) {\n                    layer.on('click', function (ev) {\n                        console.log('Survey - ResponsesLayerGeoJson - CLICK');\n                        switch (feature.properties._behavior) {\n                            case 'navigation':\n                                _this.zoomToLayer(layer, ev);\n                                break;\n                            default:\n                                _this.onLayerClick(layer, ev);\n                                _this.zoomToLayer(layer, ev);\n                                break;\n                        }\n                    });\n                    layer.on('mouseover', function () {\n                        if (layer.feature.properties.activePopup) {\n                            return;\n                        }\n                        if (_this.mapResponse.settings.styles[feature.properties._s2]) {\n                            _this.setLayerHoverStyle(layer);\n                        }\n                    });\n                    layer.on('mouseout', function () {\n                        if (layer.feature.properties.activePopup || _this.activeLayer === layer) {\n                            return;\n                        }\n                        if (_this.mapResponse.settings.styles[feature.properties._s1]) {\n                            _this.setLayerDefaultStyle(layer);\n                        }\n                    });\n                },\n                pointToLayer: function pointToLayer(feature, latlng) {\n                    return L.circleMarker(latlng, _this.mapResponse.settings.styles[feature.properties._s1]);\n                }\n            }).addTo(this.map);\n\n            this.setInitialMapView();\n        }\n    }, {\n        key: 'initMap',\n        value: function initMap() {\n            var elMap = document.getElementById('mapMain');\n            if (!elMap) {\n                return;\n            }\n\n            this.map = new L.map('mapMain', {\n                updateWhenZooming: false,\n                attributionControl: false\n            });\n\n            this.map.setActiveArea('map-active-area');\n            this.map.setActiveArea(_mapConfig.defaultObjectStyle.mapActiveArea);\n        }\n    }, {\n        key: 'events',\n        value: function events() {\n            var _this2 = this;\n\n            $(document).on('click', '[data-confirm-cancel]', function () {\n                _this2.removeAllPopups();\n            });\n\n            $(document).on('click', '[data-confirm-cancel]', function () {\n                _this2.removeAllPopups();\n            });\n\n            $(document).on('click', '[href=\"collections\"]', function (e) {\n                $(e.currentTarget).toggleClass('.active');\n            });\n\n            this.map.on('moveend', (0, _helpers.debounce)(function () {\n                var center = _this2.map.getCenter();\n                _this2.updateMap(center);\n            }, 200));\n\n            this.map.on('locationfound', this.setMapViewToMyLocation.bind(this));\n            this.map.on('locationerror', this.setInitialMapView.bind(this));\n\n            window.addEventListener('resize', (0, _helpers.debounce)(function () {\n                _this2.setActiveArea();\n            }, 200, false), false);\n        }\n    }, {\n        key: 'selectInitialElements',\n        value: function selectInitialElements() {\n            _mapConfig.defaultElConfig.elHeader = document.querySelector(_mapConfig.defaultElConfig.headerId);\n        }\n    }, {\n        key: 'toggleHeaderEl',\n        value: function toggleHeaderEl(isActive) {\n            if (window.innerWidth > 768 && !isActive) {\n                return;\n            }\n\n            if (isActive || !_mapConfig.defaultElConfig.elHeader.classList.contains('active') && isActive) {\n                _mapConfig.defaultElConfig.elHeader.classList.add('active');\n                this.addToActiveAreaList(_mapConfig.defaultElConfig.elHeader);\n            } else {\n                _mapConfig.defaultElConfig.elHeader.classList.remove('active');\n                this.removeFromActiveAreaList(_mapConfig.defaultElConfig.elHeader);\n            }\n        }\n    }, {\n        key: 'updateMap',\n        value: function updateMap(center) {\n            var _this3 = this;\n\n            var fn = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : function () {};\n\n            var zoom = this.map.getZoom();\n            var bounds = this.map.getBounds();\n            var returnedTarget = {};\n\n            var a = {\n                in: bounds._southWest.lng + ',' + bounds._northEast.lat + ',' + bounds._northEast.lng + ',' + bounds._southWest.lat + ',',\n                zoom: zoom,\n                c: center.lat + ',' + center.lng\n            };\n\n            if (typeof b !== 'undefined') {\n                returnedTarget = Object.assign(a, b);\n            } else {\n                returnedTarget = a;\n            }\n\n            $.ajax({\n                data: returnedTarget,\n                url: '/front-end/map?',\n                success: function success(results) {\n                    _this3.isMapLoaded = true;\n                    _this3.mapResponse.settings = results.settings;\n                    _this3.mapResponse.ObjectsLayerGeoJson.clearLayers();\n\n                    _this3.mapResponse.ObjectsLayerGeoJson.addData(results.objects);\n                    _this3.mapResponse.CollectionsLayerControl.clearLayers();\n\n                    var geoCollectinResult = results.geoCollections;\n\n                    for (var removeThisObj in geoCollectinResult) {\n                        if (geoCollectinResult.hasOwnProperty(removeThisObj)) {\n                            (function () {\n                                var collection = new _collections.Collection(_this3, _this3.mapResponse.settings);\n\n                                collection.layer._leaflet_id = removeThisObj;\n                                geoCollectinResult[removeThisObj].forEach(function (item) {\n                                    collection.layer.addData(item);\n                                });\n\n                                _this3.mapResponse.CollectionsLayerControl.addLayer(collection.layer);\n                            })();\n                        }\n                    }\n\n                    _this3.mapResponse.SurveyResponsesLayerGeoJson.clearLayers();\n                    _this3.mapResponse.SurveyResponsesLayerGeoJson.addData(results.surveyResponses);\n\n                    _this3.setLayerActiveStyle();\n                    fn();\n                }\n            });\n        }\n    }, {\n        key: 'saveViewport',\n        value: function saveViewport(center) {\n            var zoom = this.map.getZoom();\n            var a = {\n                zoom: zoom,\n                c: center.lat + ',' + center.lng\n            };\n\n            $.ajax({\n                data: a,\n                url: \"/map/z\",\n                success: function success(results) {}\n            });\n        }\n    }, {\n        key: 'locate',\n        value: function locate() {\n            this.loading.removeClass('d-none');\n            this.map.locate({\n                setView: true,\n                maxZoom: this.mapResponse.settings.default_zoom\n            });\n        }\n    }, {\n        key: 'setMapViewToMyLocation',\n        value: function setMapViewToMyLocation(e) {\n            var _this4 = this;\n\n            this.loading.addClass('d-none');\n            var radius = e.accuracy / 2;\n\n            this.myLocationLayerGroup.eachLayer(function (layer) {\n                _this4.myLocationLayerGroup.removeLayer(layer);\n            });\n\n            var center = L.circle(e.latlng, {\n                color: '#fff',\n                fillColor: '#2A93EE',\n                fillOpacity: 1,\n                weight: 4,\n                opacity: 1,\n                radius: 5\n            }).addTo(this.myLocationLayerGroup);\n\n            L.circle(e.latlng, {\n                radius: e.accuracy / 2,\n                color: '#136AEC',\n                fillColor: '#136AEC',\n                fillOpacity: 0.15,\n                weight: 0\n            }).addTo(this.myLocationLayerGroup);\n\n            center.bindPopup(\"Намирате се в радиус от \" + radius + \" метра от тази локация\", {\n                offset: L.point(0, -10)\n            });\n            center.openPopup();\n        }\n    }, {\n        key: 'setInitialMapView',\n        value: function setInitialMapView() {\n            var _this5 = this;\n\n            this.loading.addClass('d-none');\n\n            var zoom = void 0;\n            var lat = void 0;\n            var lng = void 0;\n\n            $.ajax({\n                url: \"/map/p\",\n                success: function success(results) {\n                    zoom = results.zoom;\n                    lat = results.lat;\n                    lng = results.lng;\n                    _this5.setRealInitialMapView(lat, lng, zoom);\n                }\n            });\n        }\n    }, {\n        key: 'setRealInitialMapView',\n        value: function setRealInitialMapView(lat, lng, zoom) {\n            this.map.setView([lat, lng], zoom);\n        }\n    }, {\n        key: 'zoomToLayer',\n        value: function zoomToLayer(layer, ev, coordinates) {\n            var clickCoordinates = coordinates || ev.latlng;\n            if (layer && layer.feature.properties._zoom && layer.feature.properties._zoom !== this.map.getZoom()) {\n                this.map.setView(clickCoordinates, layer.feature.properties._zoom);\n            } else {\n                this.map.setView(clickCoordinates);\n\n                this.saveViewport(clickCoordinates);\n            }\n        }\n    }, {\n        key: 'onLayerClick',\n        value: function onLayerClick(layer, ev) {\n            console.log('CLICK 1');\n            console.log(this.voteSurvay);\n            // const targetToggleEl = document.getElementById(e.currentTarget.getAttribute('data-toggle-for'));\n            // targetToggleEl.classList.remove('active');\n            // this.voteSurvay.close();\n\n            if ($('#path-vote-survey').hasClass('active')) {\n                $('#path-vote-survey').removeClass('active');\n            }\n\n            layer.feature.properties.activePopup = true;\n            this.setLayerActiveStyle(layer);\n            this.removeAllPopups();\n\n            switch (layer.feature.properties._behavior) {\n                case 'info':\n                    this.openInfoPopup(layer, ev);\n                    break;\n                case 'survey':\n                    if (this.collections.isCollectionsActive && this.collections.isCollectionShown) {\n                        this.collections.add(layer, ev);\n                    } else {\n                        this.openSuerveyPopup(layer, ev);\n                    }\n                    break;\n            }\n        }\n    }, {\n        key: 'removeAllPopups',\n        value: function removeAllPopups() {\n            var _this6 = this;\n\n            this.map.closePopup();\n            this.popusLayerGroup.eachLayer(function (layer) {\n                _this6.popusLayerGroup.removeLayer(layer);\n            });\n        }\n    }, {\n        key: 'onPopupClose',\n        value: function onPopupClose(layer) {\n            layer.feature.properties.activePopup = false;\n            this.activeLayer = null;\n            this.setLayerDefaultStyle(layer);\n            this.removeAllPopups();\n        }\n    }, {\n        key: 'openInfoPopup',\n        value: function openInfoPopup(layer, ev) {\n            var _this7 = this;\n\n            var coordinates = this.map.mouseEventToLatLng(ev.originalEvent);\n\n            var popupLayer = L.circle(coordinates, {\n                fillOpacity: 0,\n                weight: 0,\n                opacity: 0,\n                radius: 1\n            }).addTo(this.popusLayerGroup);\n\n            var infoTemplate = '\\n            <p class=\"text-center\">\\n                ' + layer.feature.properties.type + '\\n                <br />\\n                ' + layer.feature.properties.name + '\\n            </p>\\n        ';\n\n            var popupContent = infoTemplate;\n\n            popupLayer.bindPopup(popupContent, {\n                offset: L.point(0, -20)\n            }).on('popupclose', function () {\n                _this7.onPopupClose(layer);\n            }).openPopup();\n        }\n    }, {\n        key: 'openSuerveyPopup',\n        value: function openSuerveyPopup(layer, ev) {\n            var _this8 = this;\n\n            var coordinates = this.map.mouseEventToLatLng(ev.originalEvent);\n            this.setSurveyData(layer, ev);\n\n            var popupLayer = L.circle(coordinates, {\n                fillOpacity: 0,\n                weight: 0,\n                opacity: 0,\n                radius: 1\n            }).addTo(this.popusLayerGroup);\n\n            var surveyTemplate = '\\n            <p class=\"text-center\">\\n                ' + layer.feature.properties.type + '\\n                <br />\\n                ' + layer.feature.properties.name + '\\n            </p>\\n            <div class=\"survey-modal text-center\">\\n                <h5 class=\"font-weight-bold mb-2 h6\" data-confirm-title>\\n                    \\u0418\\u0441\\u043A\\u0430\\u0442\\u0435 \\u043B\\u0438 \\u0434\\u0430 \\u043E\\u0446\\u0435\\u043D\\u0438\\u0442\\u0435\\n                </h5>\\n                <button data-toggle-open class=\"btn btn-success mr-3 py-0 px-2\" data-toggle-for=\"path-vote-survey\"  data-url=\"' + (_mapConfig.apiEndpoints.geo + layer.feature.properties.id) + '\">\\u0414\\u0410</button>\\n                <button data-confirm-cancel class=\"btn btn-danger cursor-pointer py-0 px-2\">\\u041D\\u0415</button>\\n            </div>\\n        ';\n\n            var popupContent = surveyTemplate;\n\n            popupLayer.bindPopup(popupContent, {\n                // offset: L.point(0, -20)\n            }).on('popupclose', function () {\n                _this8.onPopupClose(layer);\n            }).openPopup();\n        }\n    }, {\n        key: 'setLayerDefaultStyle',\n        value: function setLayerDefaultStyle(layer) {\n            layer.setStyle(this.mapResponse.settings.styles[layer.feature.properties._s1] || _mapConfig.defaultObjectStyle);\n        }\n    }, {\n        key: 'setLayerHoverStyle',\n        value: function setLayerHoverStyle(layer) {\n            layer.setStyle(this.mapResponse.settings.styles[layer.feature.properties._s2]);\n        }\n    }, {\n        key: 'setLayerActiveStyle',\n        value: function setLayerActiveStyle(layer) {\n            if (layer) {\n                this.activeLayer = layer;\n            } else if (!this.activeLayer) {\n                return;\n            } else {\n                this.activeLayer.addTo(this.map);\n            }\n\n            this.activeLayer.bringToFront();\n\n            switch (this.activeLayer.feature.geometry.type) {\n                case 'Point':\n                    this.activeLayer.setStyle(this.mapResponse.settings.styles['on_dialog_point']);\n                    break;\n                case 'MultiLineString':\n                    this.activeLayer.setStyle(this.mapResponse.settings.styles['on_dialog_line']);\n                    break;\n                case 'Polygon':\n                    this.activeLayer.setStyle(this.mapResponse.settings.styles['on_dialog_polygon']);\n                    break;\n            }\n        }\n    }, {\n        key: 'setCollection',\n        value: function setCollection(collctions) {\n            this.collections = collctions;\n        }\n    }, {\n        key: 'setSurvey',\n        value: function setSurvey(voteSurvay) {\n            this.voteSurvay = voteSurvay;\n        }\n    }, {\n        key: 'setSurveyData',\n        value: function setSurveyData(layer, ev) {\n            this.voteSurvay.setLayerData(layer, ev);\n        }\n    }, {\n        key: 'setActiveArea',\n        value: function setActiveArea() {\n            var _this9 = this;\n\n            if (!this.map._loaded) {\n                return;\n            }\n\n            var top = 0,\n                bottom = 0,\n                left = 0,\n                right = 0;\n\n            var callculatedWidth = 0,\n                callculatedWidthLeft = 0,\n                callculatedWidthRight = 0,\n                callculatedHeight = 0,\n                callculatedHeightTop = 0,\n                callculatedHeightBot = 0;\n\n            this.activeAreaList.forEach(function (el) {\n                var elWidth = parseFloat(getComputedStyle(el).getPropertyValue('width')),\n                    elHeight = parseFloat(getComputedStyle(el).getPropertyValue('height')),\n                    elTop = parseFloat(getComputedStyle(el).getPropertyValue('top')),\n                    elBottom = parseFloat(getComputedStyle(el).getPropertyValue('bottom')),\n                    elLeft = parseFloat(getComputedStyle(el).getPropertyValue('left')),\n                    elRight = parseFloat(getComputedStyle(el).getPropertyValue('right'));\n\n                // Optimise this code repetition\n                if (el.clientWidth === window.innerWidth) {\n                    if (Math.round(elBottom) <= 0) {\n                        // Bottom\n                        if (elHeight > callculatedHeightBot) {\n                            callculatedHeightBot = elHeight;\n                        }\n                    } else if (Math.round(elTop) === 0) {\n                        // TOP\n                        if (elHeight > callculatedHeightTop) {\n                            top = elHeight;\n                            callculatedHeightTop = elHeight;\n                        }\n                    }\n\n                    callculatedHeight = callculatedHeightTop + callculatedHeightBot;\n                } else if (el.clientHeight === window.innerHeight) {\n                    if (Math.round(elRight) <= 0) {\n                        // Right\n                        if (elWidth > callculatedWidthRight) {\n                            callculatedWidthRight = elWidth;\n                        }\n                    } else if (Math.round(elLeft) === 0) {\n                        // Left\n                        if (elWidth > callculatedWidthLeft) {\n                            left = elWidth;\n                            callculatedWidthLeft = elWidth;\n                        }\n                    }\n\n                    callculatedWidth = callculatedWidthLeft + callculatedWidthRight;\n                }\n            });\n\n            var width = window.innerWidth - callculatedWidth;\n            var height = window.innerHeight - callculatedHeight;\n\n            var lastCenterPoint = this.map.getCenter();\n\n            setTimeout(function () {\n                _this9.map.panTo(lastCenterPoint);\n            }, 200);\n\n            this.map.setActiveArea(_extends({}, _mapConfig.defaultObjectStyle.mapActiveArea, {\n                width: width + 'px',\n                height: height + 'px',\n                top: top + 'px',\n                bottom: bottom + 'px',\n                left: left + 'px',\n                right: right + 'px'\n            }));\n        }\n    }, {\n        key: 'addToActiveAreaList',\n        value: function addToActiveAreaList(activeAreaConfig) {\n            if (!this.activeAreaList.includes(activeAreaConfig)) {\n                this.activeAreaList.push(activeAreaConfig);\n                this.setActiveArea();\n            }\n        }\n    }, {\n        key: 'removeFromActiveAreaList',\n        value: function removeFromActiveAreaList(activeAreaConfig) {\n            var index = this.activeAreaList.indexOf(activeAreaConfig);\n\n            if (index > -1) {\n                this.activeAreaList.splice(index, 1);\n                this.setActiveArea();\n            }\n        }\n    }]);\n\n    return Map;\n}();\n\n;//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNC5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy9hc3NldHMvZnJvbnQvanMvbWFwLW1haW4uanM/MGFiMyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBtYXBCb3hBdHRyaWJ1dGlvbiwgbWFwQm94VXJsLCBhcGlFbmRwb2ludHMsIGRlZmF1bHRPYmplY3RTdHlsZSwgZGVmYXVsdEVsQ29uZmlnIH0gZnJvbSAnLi9tYXAtY29uZmlnJztcbmltcG9ydCB7IGRlYm91bmNlIH0gZnJvbSAnLi9oZWxwZXJzJztcbmltcG9ydCB7IENvbGxlY3Rpb24gfSBmcm9tICcuL2NvbGxlY3Rpb25zJztcbi8vIGltcG9ydCB7IGRlZmF1bHRNYXBTaXplIH0gZnJvbSAnLi9tYXAtY29uZmlnJztcblxuZXhwb3J0IGNsYXNzIE1hcCB7XG4gICAgbWFwO1xuICAgIGFjdGl2ZUxheWVyO1xuICAgIG15TG9jYXRpb25MYXllckdyb3VwID0gTC5sYXllckdyb3VwKCk7XG4gICAgcG9wdXNMYXllckdyb3VwID0gTC5sYXllckdyb3VwKCk7XG4gICAgdm90ZVN1cnZheTtcbiAgICBtYXBSZXNwb25zZSA9IHtcbiAgICAgICAgc2V0dGluZ3M6IHt9LFxuICAgICAgICBPYmplY3RzTGF5ZXJHZW9Kc29uOiB7fSxcbiAgICAgICAgQ29sbGVjdGlvbnNMYXllckNvbnRyb2w6IHt9LFxuICAgICAgICBTdXJ2ZXlSZXNwb25zZXM6IHt9LFxuICAgIH07XG4gICAgYWN0aXZlQXJlYUxpc3QgPSBbXTtcbiAgICBpc01hcExvYWRlZCA9IGZhbHNlO1xuXG5cbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICB9XG5cbiAgICBpbml0KCkge1xuICAgICAgICB0aGlzLmluaXRNYXAoKTtcbiAgICAgICAgdGhpcy5zZWxlY3RJbml0aWFsRWxlbWVudHMoKTtcbiAgICAgICAgdGhpcy5ldmVudHMoKTtcbiAgICAgICAgdGhpcy5sb2FkaW5nID0gJCgnLmxvYWRpbmcnKTtcbiAgICAgICAgdGhpcy50b2dnbGVIZWFkZXJFbCh0cnVlKTtcbiAgICAgICAgLy9jb25zdCBtYXBDZW50ZXIgPSBtYXBPcHRpb24uY2VudGVyO1xuICAgICAgICAvL2NvbnN0IG1hcFpvb20gPSBtYXBPcHRpb24uem9vbTtcblxuICAgICAgICBsZXQgbWFwU3R5bGUgPSBMLnRpbGVMYXllcihtYXBCb3hVcmwsIHtcbiAgICAgICAgICAgIGF0dHJpYnV0aW9uOiBtYXBCb3hBdHRyaWJ1dGlvbixcbiAgICAgICAgICAgIC8vICogSWYgZGlmZmVyZW5jZSBiZXR3ZWVuIFwibWF4TmF0aXZlWm9vbVwiIGFuZCBcIm1heFpvb21cIiA9PT0gMlxuICAgICAgICAgICAgLy8gYW5kIFwibGVhZkxldC1hY3RpdmUtYXJlYVwiIGlzIGluY2x1ZGVkICBcIk1heGltdW0gY2FsbCBzdGFjayBzaXplIGV4Y2VlZGVkXCIgaXMgdGhyb3duIG9uIG1heCB6b29tIHJlYWNoZWQuXG4gICAgICAgICAgICAvLyBodHRwczovL2dpdGh1Yi5jb20vTWFwcHkvTGVhZmxldC1hY3RpdmUtYXJlYS9pc3N1ZXMvMzJcbiAgICAgICAgICAgIG1heE5hdGl2ZVpvb206IDIwLFxuICAgICAgICAgICAgbWF4Wm9vbTogMjEsXG4gICAgICAgICAgICBtaW5ab29tOiAxMSxcbiAgICAgICAgICAgIHVwZGF0ZVdoZW5ab29taW5nOiBmYWxzZVxuICAgICAgICB9KTtcbiAgICAgICAgbWFwU3R5bGUuYWRkVG8odGhpcy5tYXApO1xuXG4gICAgICAgIGxldCBteUxvY2F0aW9uQnV0dG9uID0gTC5Db250cm9sLmV4dGVuZCh7XG4gICAgICAgICAgICBvcHRpb25zOiB7XG4gICAgICAgICAgICAgICAgcG9zaXRpb246ICd0b3BsZWZ0J1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG9uQWRkOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgbGV0IGNvbnRhaW5lciA9IEwuRG9tVXRpbC5jcmVhdGUoJ2J1dHRvbicsICdsZWFmbGV0LWJhciBsZWFmbGV0LWNvbnRyb2wtY3VzdG9tIGZhciBmYS1kb3QtY2lyY2xlJyk7XG4gICAgICAgICAgICAgICAgY29udGFpbmVyLnR5cGUgPSAnYnV0dG9uJztcbiAgICAgICAgICAgICAgICBjb250YWluZXIub25jbGljayA9ICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2NhdGUoKTtcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIHJldHVybiBjb250YWluZXI7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLm1hcC5hZGRDb250cm9sKG5ldyBteUxvY2F0aW9uQnV0dG9uKCkpO1xuXG4gICAgICAgIHRoaXMubXlMb2NhdGlvbkxheWVyR3JvdXAuYWRkVG8odGhpcy5tYXApO1xuXG4gICAgICAgIHRoaXMucG9wdXNMYXllckdyb3VwLmFkZFRvKHRoaXMubWFwKTtcblxuICAgICAgICB0aGlzLm1hcFJlc3BvbnNlLk9iamVjdHNMYXllckdlb0pzb24gPSBMLmdlb0pTT04oW10sIHtcbiAgICAgICAgICAgIHN0eWxlOiAoZmVhdHVyZSkgPT4ge1xuICAgICAgICAgICAgICAgIGxldCBzdHlsZXMgPSB0aGlzLm1hcFJlc3BvbnNlLnNldHRpbmdzLnN0eWxlc1tmZWF0dXJlLnByb3BlcnRpZXMuX3MxXSA/IHsuLi50aGlzLm1hcFJlc3BvbnNlLnNldHRpbmdzLnN0eWxlc1tmZWF0dXJlLnByb3BlcnRpZXMuX3MxXX0gOiB7Li4uZGVmYXVsdE9iamVjdFN0eWxlfTtcbiAgICAgICAgICAgICAgICByZXR1cm4gc3R5bGVzO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG9uRWFjaEZlYXR1cmU6IChmZWF0dXJlLCBsYXllcikgPT4ge1xuICAgICAgICAgICAgICAgIGxheWVyLm9uKCdjbGljaycsIChldikgPT4ge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnT2JqZWN0IExheWVyR2VvSnNvbiBDTElDSycpO1xuICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKGZlYXR1cmUucHJvcGVydGllcy5fYmVoYXZpb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ25hdmlnYXRpb24nOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuem9vbVRvTGF5ZXIobGF5ZXIsIGV2KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5vbkxheWVyQ2xpY2sobGF5ZXIsIGV2KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnpvb21Ub0xheWVyKGxheWVyLCBldik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBsYXllci5vbignbW91c2VvdmVyJywgKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBpZiAobGF5ZXIuZmVhdHVyZS5wcm9wZXJ0aWVzLmFjdGl2ZVBvcHVwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMubWFwUmVzcG9uc2Uuc2V0dGluZ3Muc3R5bGVzW2ZlYXR1cmUucHJvcGVydGllcy5fczJdKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNldExheWVySG92ZXJTdHlsZShsYXllcik7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBsYXllci5vbignbW91c2VvdXQnLCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChsYXllci5mZWF0dXJlLnByb3BlcnRpZXMuYWN0aXZlUG9wdXAgfHwgdGhpcy5hY3RpdmVMYXllciA9PT0gbGF5ZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5tYXBSZXNwb25zZS5zZXR0aW5ncy5zdHlsZXNbZmVhdHVyZS5wcm9wZXJ0aWVzLl9zMV0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0TGF5ZXJEZWZhdWx0U3R5bGUobGF5ZXIpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcG9pbnRUb0xheWVyOiAoZmVhdHVyZSwgbGF0bG5nKSA9PiB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIEwuY2lyY2xlTWFya2VyKGxhdGxuZywgdGhpcy5tYXBSZXNwb25zZS5zZXR0aW5ncy5zdHlsZXNbZmVhdHVyZS5wcm9wZXJ0aWVzLl9zMV0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KS5hZGRUbyh0aGlzLm1hcCk7XG5cblxuICAgICAgICB0aGlzLm1hcFJlc3BvbnNlLkNvbGxlY3Rpb25zTGF5ZXJDb250cm9sID0gTC5sYXllckdyb3VwKCkuYWRkVG8odGhpcy5tYXApO1xuXG4gICAgICAgIHRoaXMubWFwUmVzcG9uc2UuU3VydmV5UmVzcG9uc2VzTGF5ZXJHZW9Kc29uID0gTC5nZW9KU09OKFtdLCB7XG4gICAgICAgICAgICBzdHlsZTogKGZlYXR1cmUpID0+IHtcbiAgICAgICAgICAgICAgICBsZXQgc3R5bGVzID0gdGhpcy5tYXBSZXNwb25zZS5zZXR0aW5ncy5zdHlsZXNbZmVhdHVyZS5wcm9wZXJ0aWVzLl9zMV0gPyB7Li4udGhpcy5tYXBSZXNwb25zZS5zZXR0aW5ncy5zdHlsZXNbZmVhdHVyZS5wcm9wZXJ0aWVzLl9zMV19IDogey4uLmRlZmF1bHRPYmplY3RTdHlsZX07XG4gICAgICAgICAgICAgICAgcmV0dXJuIHN0eWxlcztcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBvbkVhY2hGZWF0dXJlOiAoZmVhdHVyZSwgbGF5ZXIpID0+IHtcbiAgICAgICAgICAgICAgICBsYXllci5vbignY2xpY2snLCAoZXYpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ1N1cnZleSAtIFJlc3BvbnNlc0xheWVyR2VvSnNvbiAtIENMSUNLJyk7XG4gICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoZmVhdHVyZS5wcm9wZXJ0aWVzLl9iZWhhdmlvcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnbmF2aWdhdGlvbic6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy56b29tVG9MYXllcihsYXllciwgZXYpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm9uTGF5ZXJDbGljayhsYXllciwgZXYpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuem9vbVRvTGF5ZXIobGF5ZXIsIGV2KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGxheWVyLm9uKCdtb3VzZW92ZXInLCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChsYXllci5mZWF0dXJlLnByb3BlcnRpZXMuYWN0aXZlUG9wdXApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5tYXBSZXNwb25zZS5zZXR0aW5ncy5zdHlsZXNbZmVhdHVyZS5wcm9wZXJ0aWVzLl9zMl0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0TGF5ZXJIb3ZlclN0eWxlKGxheWVyKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGxheWVyLm9uKCdtb3VzZW91dCcsICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGxheWVyLmZlYXR1cmUucHJvcGVydGllcy5hY3RpdmVQb3B1cCB8fCB0aGlzLmFjdGl2ZUxheWVyID09PSBsYXllcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLm1hcFJlc3BvbnNlLnNldHRpbmdzLnN0eWxlc1tmZWF0dXJlLnByb3BlcnRpZXMuX3MxXSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRMYXllckRlZmF1bHRTdHlsZShsYXllcik7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBwb2ludFRvTGF5ZXI6IChmZWF0dXJlLCBsYXRsbmcpID0+IHtcbiAgICAgICAgICAgICAgICByZXR1cm4gTC5jaXJjbGVNYXJrZXIobGF0bG5nLCB0aGlzLm1hcFJlc3BvbnNlLnNldHRpbmdzLnN0eWxlc1tmZWF0dXJlLnByb3BlcnRpZXMuX3MxXSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pLmFkZFRvKHRoaXMubWFwKTtcblxuICAgICAgICB0aGlzLnNldEluaXRpYWxNYXBWaWV3KCk7XG4gICAgfVxuXG4gICAgaW5pdE1hcCgpIHtcbiAgICAgICAgY29uc3QgZWxNYXAgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFwTWFpbicpO1xuICAgICAgICBpZiAoIWVsTWFwKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLm1hcCA9IG5ldyBMLm1hcCgnbWFwTWFpbicsIHtcbiAgICAgICAgICAgIHVwZGF0ZVdoZW5ab29taW5nOiBmYWxzZSxcbiAgICAgICAgICAgIGF0dHJpYnV0aW9uQ29udHJvbDogZmFsc2VcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdGhpcy5tYXAuc2V0QWN0aXZlQXJlYSgnbWFwLWFjdGl2ZS1hcmVhJyk7XG4gICAgICAgIHRoaXMubWFwLnNldEFjdGl2ZUFyZWEoZGVmYXVsdE9iamVjdFN0eWxlLm1hcEFjdGl2ZUFyZWEpO1xuICAgIH1cblxuICAgIGV2ZW50cygpIHtcbiAgICAgICAgJChkb2N1bWVudCkub24oJ2NsaWNrJywgJ1tkYXRhLWNvbmZpcm0tY2FuY2VsXScsICgpID0+IHtcbiAgICAgICAgICAgIHRoaXMucmVtb3ZlQWxsUG9wdXBzKCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgICQoZG9jdW1lbnQpLm9uKCdjbGljaycsICdbZGF0YS1jb25maXJtLWNhbmNlbF0nLCAoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLnJlbW92ZUFsbFBvcHVwcygpO1xuICAgICAgICB9KTtcblxuICAgICAgICAkKGRvY3VtZW50KS5vbignY2xpY2snLCAnW2hyZWY9XCJjb2xsZWN0aW9uc1wiXScsIChlKSA9PiB7XG4gICAgICAgICAgICAkKGUuY3VycmVudFRhcmdldCkudG9nZ2xlQ2xhc3MoJy5hY3RpdmUnKVxuICAgICAgICB9KTtcblxuXG4gICAgICAgIHRoaXMubWFwLm9uKCdtb3ZlZW5kJywgZGVib3VuY2UoKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgY2VudGVyID0gdGhpcy5tYXAuZ2V0Q2VudGVyKCk7XG4gICAgICAgICAgICB0aGlzLnVwZGF0ZU1hcChjZW50ZXIpO1xuICAgICAgICB9LCAyMDApKTtcblxuICAgICAgICB0aGlzLm1hcC5vbignbG9jYXRpb25mb3VuZCcsIHRoaXMuc2V0TWFwVmlld1RvTXlMb2NhdGlvbi5iaW5kKHRoaXMpKTtcbiAgICAgICAgdGhpcy5tYXAub24oJ2xvY2F0aW9uZXJyb3InLCB0aGlzLnNldEluaXRpYWxNYXBWaWV3LmJpbmQodGhpcykpO1xuXG4gICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdyZXNpemUnLCBkZWJvdW5jZSgoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLnNldEFjdGl2ZUFyZWEoKTtcbiAgICAgICAgfSwgMjAwLCBmYWxzZSksIGZhbHNlKTtcbiAgICB9XG5cbiAgICBzZWxlY3RJbml0aWFsRWxlbWVudHMoKSB7XG4gICAgICAgIGRlZmF1bHRFbENvbmZpZy5lbEhlYWRlciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoZGVmYXVsdEVsQ29uZmlnLmhlYWRlcklkKTtcbiAgICB9XG5cbiAgICB0b2dnbGVIZWFkZXJFbChpc0FjdGl2ZSkge1xuICAgICAgICBpZiAod2luZG93LmlubmVyV2lkdGggPiA3NjggJiYgIWlzQWN0aXZlKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoaXNBY3RpdmUgfHwgIWRlZmF1bHRFbENvbmZpZy5lbEhlYWRlci5jbGFzc0xpc3QuY29udGFpbnMoJ2FjdGl2ZScpICYmIGlzQWN0aXZlKSB7XG4gICAgICAgICAgICBkZWZhdWx0RWxDb25maWcuZWxIZWFkZXIuY2xhc3NMaXN0LmFkZCgnYWN0aXZlJyk7XG4gICAgICAgICAgICB0aGlzLmFkZFRvQWN0aXZlQXJlYUxpc3QoZGVmYXVsdEVsQ29uZmlnLmVsSGVhZGVyKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGRlZmF1bHRFbENvbmZpZy5lbEhlYWRlci5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTtcbiAgICAgICAgICAgIHRoaXMucmVtb3ZlRnJvbUFjdGl2ZUFyZWFMaXN0KGRlZmF1bHRFbENvbmZpZy5lbEhlYWRlcik7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICB1cGRhdGVNYXAoY2VudGVyLCBmbiA9ICgpID0+IHtcbiAgICB9KSB7XG4gICAgICAgIGNvbnN0IHpvb20gPSB0aGlzLm1hcC5nZXRab29tKCk7XG4gICAgICAgIGNvbnN0IGJvdW5kcyA9IHRoaXMubWFwLmdldEJvdW5kcygpO1xuICAgICAgICBsZXQgcmV0dXJuZWRUYXJnZXQgPSB7fTtcblxuICAgICAgICBjb25zdCBhID0ge1xuICAgICAgICAgICAgaW46IGJvdW5kcy5fc291dGhXZXN0LmxuZyArICcsJyArXG4gICAgICAgICAgICBib3VuZHMuX25vcnRoRWFzdC5sYXQgKyAnLCcgK1xuICAgICAgICAgICAgYm91bmRzLl9ub3J0aEVhc3QubG5nICsgJywnICtcbiAgICAgICAgICAgIGJvdW5kcy5fc291dGhXZXN0LmxhdCArICcsJyxcbiAgICAgICAgICAgIHpvb206IHpvb20sXG4gICAgICAgICAgICBjOiBjZW50ZXIubGF0ICsgJywnICsgY2VudGVyLmxuZ1xuICAgICAgICB9O1xuXG4gICAgICAgIGlmICh0eXBlb2YgYiAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgIHJldHVybmVkVGFyZ2V0ID0gT2JqZWN0LmFzc2lnbihhLCBiKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybmVkVGFyZ2V0ID0gYTtcbiAgICAgICAgfVxuXG4gICAgICAgICQuYWpheCh7XG4gICAgICAgICAgICBkYXRhOiByZXR1cm5lZFRhcmdldCxcbiAgICAgICAgICAgIHVybDogJy9mcm9udC1lbmQvbWFwPycsXG4gICAgICAgICAgICBzdWNjZXNzOiAocmVzdWx0cykgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuaXNNYXBMb2FkZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgIHRoaXMubWFwUmVzcG9uc2Uuc2V0dGluZ3MgPSByZXN1bHRzLnNldHRpbmdzO1xuICAgICAgICAgICAgICAgIHRoaXMubWFwUmVzcG9uc2UuT2JqZWN0c0xheWVyR2VvSnNvbi5jbGVhckxheWVycygpO1xuXG4gICAgICAgICAgICAgICAgdGhpcy5tYXBSZXNwb25zZS5PYmplY3RzTGF5ZXJHZW9Kc29uLmFkZERhdGEocmVzdWx0cy5vYmplY3RzKTtcbiAgICAgICAgICAgICAgICB0aGlzLm1hcFJlc3BvbnNlLkNvbGxlY3Rpb25zTGF5ZXJDb250cm9sLmNsZWFyTGF5ZXJzKCk7XG5cbiAgICAgICAgICAgICAgICBjb25zdCBnZW9Db2xsZWN0aW5SZXN1bHQgPSByZXN1bHRzLmdlb0NvbGxlY3Rpb25zO1xuXG4gICAgICAgICAgICAgICAgZm9yIChjb25zdCByZW1vdmVUaGlzT2JqIGluIGdlb0NvbGxlY3RpblJlc3VsdCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoZ2VvQ29sbGVjdGluUmVzdWx0Lmhhc093blByb3BlcnR5KHJlbW92ZVRoaXNPYmopKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjb2xsZWN0aW9uID0gbmV3IENvbGxlY3Rpb24odGhpcywgdGhpcy5tYXBSZXNwb25zZS5zZXR0aW5ncyk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbGxlY3Rpb24ubGF5ZXIuX2xlYWZsZXRfaWQgPSByZW1vdmVUaGlzT2JqO1xuICAgICAgICAgICAgICAgICAgICAgICAgZ2VvQ29sbGVjdGluUmVzdWx0W3JlbW92ZVRoaXNPYmpdLmZvckVhY2goaXRlbSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sbGVjdGlvbi5sYXllci5hZGREYXRhKGl0ZW0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSlcblxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5tYXBSZXNwb25zZS5Db2xsZWN0aW9uc0xheWVyQ29udHJvbC5hZGRMYXllcihjb2xsZWN0aW9uLmxheWVyKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHRoaXMubWFwUmVzcG9uc2UuU3VydmV5UmVzcG9uc2VzTGF5ZXJHZW9Kc29uLmNsZWFyTGF5ZXJzKCk7XG4gICAgICAgICAgICAgICAgdGhpcy5tYXBSZXNwb25zZS5TdXJ2ZXlSZXNwb25zZXNMYXllckdlb0pzb24uYWRkRGF0YShyZXN1bHRzLnN1cnZleVJlc3BvbnNlcyk7XG5cbiAgICAgICAgICAgICAgICB0aGlzLnNldExheWVyQWN0aXZlU3R5bGUoKTtcbiAgICAgICAgICAgICAgICBmbigpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBzYXZlVmlld3BvcnQoY2VudGVyKSB7XG4gICAgICAgIGxldCB6b29tID0gdGhpcy5tYXAuZ2V0Wm9vbSgpO1xuICAgICAgICBsZXQgYSA9IHtcbiAgICAgICAgICAgIHpvb206IHpvb20sXG4gICAgICAgICAgICBjOiBjZW50ZXIubGF0ICsgJywnICsgY2VudGVyLmxuZ1xuICAgICAgICB9O1xuXG4gICAgICAgICQuYWpheCh7XG4gICAgICAgICAgICBkYXRhOiBhLFxuICAgICAgICAgICAgdXJsOiBcIi9tYXAvelwiLFxuICAgICAgICAgICAgc3VjY2VzczogKHJlc3VsdHMpID0+IHtcblxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBsb2NhdGUoKSB7XG4gICAgICAgIHRoaXMubG9hZGluZy5yZW1vdmVDbGFzcygnZC1ub25lJyk7XG4gICAgICAgIHRoaXMubWFwLmxvY2F0ZSh7XG4gICAgICAgICAgICBzZXRWaWV3OiB0cnVlLFxuICAgICAgICAgICAgbWF4Wm9vbTogdGhpcy5tYXBSZXNwb25zZS5zZXR0aW5ncy5kZWZhdWx0X3pvb21cbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgc2V0TWFwVmlld1RvTXlMb2NhdGlvbihlKSB7XG4gICAgICAgIHRoaXMubG9hZGluZy5hZGRDbGFzcygnZC1ub25lJyk7XG4gICAgICAgIGxldCByYWRpdXMgPSBlLmFjY3VyYWN5IC8gMjtcblxuICAgICAgICB0aGlzLm15TG9jYXRpb25MYXllckdyb3VwLmVhY2hMYXllcigobGF5ZXIpID0+IHtcbiAgICAgICAgICAgIHRoaXMubXlMb2NhdGlvbkxheWVyR3JvdXAucmVtb3ZlTGF5ZXIobGF5ZXIpO1xuICAgICAgICB9KTtcblxuICAgICAgICBsZXQgY2VudGVyID0gTC5jaXJjbGUoZS5sYXRsbmcsIHtcbiAgICAgICAgICAgIGNvbG9yOiAnI2ZmZicsXG4gICAgICAgICAgICBmaWxsQ29sb3I6ICcjMkE5M0VFJyxcbiAgICAgICAgICAgIGZpbGxPcGFjaXR5OiAxLFxuICAgICAgICAgICAgd2VpZ2h0OiA0LFxuICAgICAgICAgICAgb3BhY2l0eTogMSxcbiAgICAgICAgICAgIHJhZGl1czogNVxuICAgICAgICB9KS5hZGRUbyh0aGlzLm15TG9jYXRpb25MYXllckdyb3VwKTtcblxuICAgICAgICBMLmNpcmNsZShlLmxhdGxuZywge1xuICAgICAgICAgICAgcmFkaXVzOiBlLmFjY3VyYWN5IC8gMixcbiAgICAgICAgICAgIGNvbG9yOiAnIzEzNkFFQycsXG4gICAgICAgICAgICBmaWxsQ29sb3I6ICcjMTM2QUVDJyxcbiAgICAgICAgICAgIGZpbGxPcGFjaXR5OiAwLjE1LFxuICAgICAgICAgICAgd2VpZ2h0OiAwXG4gICAgICAgIH0pLmFkZFRvKHRoaXMubXlMb2NhdGlvbkxheWVyR3JvdXApO1xuXG4gICAgICAgIGNlbnRlci5iaW5kUG9wdXAoXCLQndCw0LzQuNGA0LDRgtC1INGB0LUg0LIg0YDQsNC00LjRg9GBINC+0YIgXCIgKyByYWRpdXMgKyBcIiDQvNC10YLRgNCwINC+0YIg0YLQsNC30Lgg0LvQvtC60LDRhtC40Y9cIiwge1xuICAgICAgICAgICAgb2Zmc2V0OiBMLnBvaW50KDAsIC0xMClcbiAgICAgICAgfSk7XG4gICAgICAgIGNlbnRlci5vcGVuUG9wdXAoKTtcbiAgICB9XG5cbiAgICBzZXRJbml0aWFsTWFwVmlldygpIHtcbiAgICAgICAgdGhpcy5sb2FkaW5nLmFkZENsYXNzKCdkLW5vbmUnKTtcblxuICAgICAgICBsZXQgem9vbTtcbiAgICAgICAgbGV0IGxhdDtcbiAgICAgICAgbGV0IGxuZztcblxuICAgICAgICAkLmFqYXgoe1xuICAgICAgICAgICAgdXJsOiBcIi9tYXAvcFwiLFxuICAgICAgICAgICAgc3VjY2VzczogKHJlc3VsdHMpID0+IHtcbiAgICAgICAgICAgICAgICB6b29tID0gcmVzdWx0cy56b29tO1xuICAgICAgICAgICAgICAgIGxhdCA9IHJlc3VsdHMubGF0O1xuICAgICAgICAgICAgICAgIGxuZyA9IHJlc3VsdHMubG5nO1xuICAgICAgICAgICAgICAgIHRoaXMuc2V0UmVhbEluaXRpYWxNYXBWaWV3KGxhdCwgbG5nLCB6b29tKVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBzZXRSZWFsSW5pdGlhbE1hcFZpZXcobGF0LCBsbmcsIHpvb20pIHtcbiAgICAgICAgdGhpcy5tYXAuc2V0VmlldyhbbGF0LCBsbmddLCB6b29tKVxuICAgIH1cblxuICAgIHpvb21Ub0xheWVyKGxheWVyLCBldiwgY29vcmRpbmF0ZXMpIHtcbiAgICAgICAgbGV0IGNsaWNrQ29vcmRpbmF0ZXMgPSBjb29yZGluYXRlcyB8fCBldi5sYXRsbmc7XG4gICAgICAgIGlmIChsYXllciAmJiBsYXllci5mZWF0dXJlLnByb3BlcnRpZXMuX3pvb20gJiYgbGF5ZXIuZmVhdHVyZS5wcm9wZXJ0aWVzLl96b29tICE9PSB0aGlzLm1hcC5nZXRab29tKCkpIHtcbiAgICAgICAgICAgIHRoaXMubWFwLnNldFZpZXcoY2xpY2tDb29yZGluYXRlcywgbGF5ZXIuZmVhdHVyZS5wcm9wZXJ0aWVzLl96b29tKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMubWFwLnNldFZpZXcoY2xpY2tDb29yZGluYXRlcyk7XG5cbiAgICAgICAgICAgIHRoaXMuc2F2ZVZpZXdwb3J0KGNsaWNrQ29vcmRpbmF0ZXMpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgb25MYXllckNsaWNrKGxheWVyLCBldikge1xuICAgICAgICBjb25zb2xlLmxvZygnQ0xJQ0sgMScpO1xuICAgICAgICBjb25zb2xlLmxvZyh0aGlzLnZvdGVTdXJ2YXkpO1xuICAgICAgICAvLyBjb25zdCB0YXJnZXRUb2dnbGVFbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGUuY3VycmVudFRhcmdldC5nZXRBdHRyaWJ1dGUoJ2RhdGEtdG9nZ2xlLWZvcicpKTtcbiAgICAgICAgLy8gdGFyZ2V0VG9nZ2xlRWwuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7XG4gICAgICAgIC8vIHRoaXMudm90ZVN1cnZheS5jbG9zZSgpO1xuXG4gICAgICAgIGlmICgkKCcjcGF0aC12b3RlLXN1cnZleScpLmhhc0NsYXNzKCdhY3RpdmUnKSkge1xuICAgICAgICAgICAgJCgnI3BhdGgtdm90ZS1zdXJ2ZXknKS5yZW1vdmVDbGFzcygnYWN0aXZlJyk7XG4gICAgICAgIH1cblxuICAgICAgICBsYXllci5mZWF0dXJlLnByb3BlcnRpZXMuYWN0aXZlUG9wdXAgPSB0cnVlO1xuICAgICAgICB0aGlzLnNldExheWVyQWN0aXZlU3R5bGUobGF5ZXIpO1xuICAgICAgICB0aGlzLnJlbW92ZUFsbFBvcHVwcygpO1xuXG4gICAgICAgIHN3aXRjaCAobGF5ZXIuZmVhdHVyZS5wcm9wZXJ0aWVzLl9iZWhhdmlvcikge1xuICAgICAgICAgICAgY2FzZSAnaW5mbyc6XG4gICAgICAgICAgICAgICAgdGhpcy5vcGVuSW5mb1BvcHVwKGxheWVyLCBldik7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICdzdXJ2ZXknOlxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmNvbGxlY3Rpb25zLmlzQ29sbGVjdGlvbnNBY3RpdmUgJiYgdGhpcy5jb2xsZWN0aW9ucy5pc0NvbGxlY3Rpb25TaG93bikge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbGxlY3Rpb25zLmFkZChsYXllciwgZXYpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMub3BlblN1ZXJ2ZXlQb3B1cChsYXllciwgZXYpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHJlbW92ZUFsbFBvcHVwcygpIHtcbiAgICAgICAgdGhpcy5tYXAuY2xvc2VQb3B1cCgpO1xuICAgICAgICB0aGlzLnBvcHVzTGF5ZXJHcm91cC5lYWNoTGF5ZXIoKGxheWVyKSA9PiB7XG4gICAgICAgICAgICB0aGlzLnBvcHVzTGF5ZXJHcm91cC5yZW1vdmVMYXllcihsYXllcik7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIG9uUG9wdXBDbG9zZShsYXllcikge1xuICAgICAgICBsYXllci5mZWF0dXJlLnByb3BlcnRpZXMuYWN0aXZlUG9wdXAgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5hY3RpdmVMYXllciA9IG51bGw7XG4gICAgICAgIHRoaXMuc2V0TGF5ZXJEZWZhdWx0U3R5bGUobGF5ZXIpO1xuICAgICAgICB0aGlzLnJlbW92ZUFsbFBvcHVwcygpO1xuICAgIH1cblxuICAgIG9wZW5JbmZvUG9wdXAobGF5ZXIsIGV2KSB7XG4gICAgICAgIGNvbnN0IGNvb3JkaW5hdGVzID0gdGhpcy5tYXAubW91c2VFdmVudFRvTGF0TG5nKGV2Lm9yaWdpbmFsRXZlbnQpO1xuXG4gICAgICAgIGxldCBwb3B1cExheWVyID0gTC5jaXJjbGUoY29vcmRpbmF0ZXMsIHtcbiAgICAgICAgICAgIGZpbGxPcGFjaXR5OiAwLFxuICAgICAgICAgICAgd2VpZ2h0OiAwLFxuICAgICAgICAgICAgb3BhY2l0eTogMCxcbiAgICAgICAgICAgIHJhZGl1czogMVxuICAgICAgICB9KS5hZGRUbyh0aGlzLnBvcHVzTGF5ZXJHcm91cCk7XG5cbiAgICAgICAgY29uc3QgaW5mb1RlbXBsYXRlID0gYFxuICAgICAgICAgICAgPHAgY2xhc3M9XCJ0ZXh0LWNlbnRlclwiPlxuICAgICAgICAgICAgICAgICR7bGF5ZXIuZmVhdHVyZS5wcm9wZXJ0aWVzLnR5cGV9XG4gICAgICAgICAgICAgICAgPGJyIC8+XG4gICAgICAgICAgICAgICAgJHtsYXllci5mZWF0dXJlLnByb3BlcnRpZXMubmFtZX1cbiAgICAgICAgICAgIDwvcD5cbiAgICAgICAgYDtcblxuICAgICAgICBjb25zdCBwb3B1cENvbnRlbnQgPSBpbmZvVGVtcGxhdGU7XG5cbiAgICAgICAgcG9wdXBMYXllci5iaW5kUG9wdXAocG9wdXBDb250ZW50LCB7XG4gICAgICAgICAgICBvZmZzZXQ6IEwucG9pbnQoMCwgLTIwKVxuICAgICAgICB9KS5vbigncG9wdXBjbG9zZScsICgpID0+IHtcbiAgICAgICAgICAgIHRoaXMub25Qb3B1cENsb3NlKGxheWVyKTtcbiAgICAgICAgfSkub3BlblBvcHVwKCk7XG4gICAgfVxuXG4gICAgb3BlblN1ZXJ2ZXlQb3B1cChsYXllciwgZXYpIHtcbiAgICAgICAgY29uc3QgY29vcmRpbmF0ZXMgPSB0aGlzLm1hcC5tb3VzZUV2ZW50VG9MYXRMbmcoZXYub3JpZ2luYWxFdmVudCk7XG4gICAgICAgIHRoaXMuc2V0U3VydmV5RGF0YShsYXllciwgZXYpO1xuXG4gICAgICAgIGxldCBwb3B1cExheWVyID0gTC5jaXJjbGUoY29vcmRpbmF0ZXMsIHtcbiAgICAgICAgICAgIGZpbGxPcGFjaXR5OiAwLFxuICAgICAgICAgICAgd2VpZ2h0OiAwLFxuICAgICAgICAgICAgb3BhY2l0eTogMCxcbiAgICAgICAgICAgIHJhZGl1czogMVxuICAgICAgICB9KS5hZGRUbyh0aGlzLnBvcHVzTGF5ZXJHcm91cCk7XG5cbiAgICAgICAgY29uc3Qgc3VydmV5VGVtcGxhdGUgPSBgXG4gICAgICAgICAgICA8cCBjbGFzcz1cInRleHQtY2VudGVyXCI+XG4gICAgICAgICAgICAgICAgJHtsYXllci5mZWF0dXJlLnByb3BlcnRpZXMudHlwZX1cbiAgICAgICAgICAgICAgICA8YnIgLz5cbiAgICAgICAgICAgICAgICAke2xheWVyLmZlYXR1cmUucHJvcGVydGllcy5uYW1lfVxuICAgICAgICAgICAgPC9wPlxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cInN1cnZleS1tb2RhbCB0ZXh0LWNlbnRlclwiPlxuICAgICAgICAgICAgICAgIDxoNSBjbGFzcz1cImZvbnQtd2VpZ2h0LWJvbGQgbWItMiBoNlwiIGRhdGEtY29uZmlybS10aXRsZT5cbiAgICAgICAgICAgICAgICAgICAg0JjRgdC60LDRgtC1INC70Lgg0LTQsCDQvtGG0LXQvdC40YLQtVxuICAgICAgICAgICAgICAgIDwvaDU+XG4gICAgICAgICAgICAgICAgPGJ1dHRvbiBkYXRhLXRvZ2dsZS1vcGVuIGNsYXNzPVwiYnRuIGJ0bi1zdWNjZXNzIG1yLTMgcHktMCBweC0yXCIgZGF0YS10b2dnbGUtZm9yPVwicGF0aC12b3RlLXN1cnZleVwiICBkYXRhLXVybD1cIiR7IGFwaUVuZHBvaW50cy5nZW8gKyBsYXllci5mZWF0dXJlLnByb3BlcnRpZXMuaWQgfVwiPtCU0JA8L2J1dHRvbj5cbiAgICAgICAgICAgICAgICA8YnV0dG9uIGRhdGEtY29uZmlybS1jYW5jZWwgY2xhc3M9XCJidG4gYnRuLWRhbmdlciBjdXJzb3ItcG9pbnRlciBweS0wIHB4LTJcIj7QndCVPC9idXR0b24+XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgYDtcblxuICAgICAgICBjb25zdCBwb3B1cENvbnRlbnQgPSBzdXJ2ZXlUZW1wbGF0ZTtcblxuICAgICAgICBwb3B1cExheWVyLmJpbmRQb3B1cChwb3B1cENvbnRlbnQsIHtcbiAgICAgICAgICAgIC8vIG9mZnNldDogTC5wb2ludCgwLCAtMjApXG4gICAgICAgIH0pLm9uKCdwb3B1cGNsb3NlJywgKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5vblBvcHVwQ2xvc2UobGF5ZXIpO1xuICAgICAgICB9KS5vcGVuUG9wdXAoKTtcbiAgICB9XG5cbiAgICBzZXRMYXllckRlZmF1bHRTdHlsZShsYXllcikge1xuICAgICAgICBsYXllci5zZXRTdHlsZSh0aGlzLm1hcFJlc3BvbnNlLnNldHRpbmdzLnN0eWxlc1tsYXllci5mZWF0dXJlLnByb3BlcnRpZXMuX3MxXSB8fCBkZWZhdWx0T2JqZWN0U3R5bGUpXG4gICAgfVxuXG4gICAgc2V0TGF5ZXJIb3ZlclN0eWxlKGxheWVyKSB7XG4gICAgICAgIGxheWVyLnNldFN0eWxlKHRoaXMubWFwUmVzcG9uc2Uuc2V0dGluZ3Muc3R5bGVzW2xheWVyLmZlYXR1cmUucHJvcGVydGllcy5fczJdKVxuICAgIH1cblxuICAgIHNldExheWVyQWN0aXZlU3R5bGUobGF5ZXIpIHtcbiAgICAgICAgaWYgKGxheWVyKSB7XG4gICAgICAgICAgICB0aGlzLmFjdGl2ZUxheWVyID0gbGF5ZXI7XG4gICAgICAgIH0gZWxzZSBpZiAoIXRoaXMuYWN0aXZlTGF5ZXIpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuYWN0aXZlTGF5ZXIuYWRkVG8odGhpcy5tYXApO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5hY3RpdmVMYXllci5icmluZ1RvRnJvbnQoKTtcblxuICAgICAgICBzd2l0Y2ggKHRoaXMuYWN0aXZlTGF5ZXIuZmVhdHVyZS5nZW9tZXRyeS50eXBlKSB7XG4gICAgICAgICAgICBjYXNlICdQb2ludCc6XG4gICAgICAgICAgICAgICAgdGhpcy5hY3RpdmVMYXllci5zZXRTdHlsZSh0aGlzLm1hcFJlc3BvbnNlLnNldHRpbmdzLnN0eWxlc1snb25fZGlhbG9nX3BvaW50J10pO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAnTXVsdGlMaW5lU3RyaW5nJzpcbiAgICAgICAgICAgICAgICB0aGlzLmFjdGl2ZUxheWVyLnNldFN0eWxlKHRoaXMubWFwUmVzcG9uc2Uuc2V0dGluZ3Muc3R5bGVzWydvbl9kaWFsb2dfbGluZSddKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ1BvbHlnb24nOlxuICAgICAgICAgICAgICAgIHRoaXMuYWN0aXZlTGF5ZXIuc2V0U3R5bGUodGhpcy5tYXBSZXNwb25zZS5zZXR0aW5ncy5zdHlsZXNbJ29uX2RpYWxvZ19wb2x5Z29uJ10pO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgc2V0Q29sbGVjdGlvbihjb2xsY3Rpb25zKSB7XG4gICAgICAgIHRoaXMuY29sbGVjdGlvbnMgPSBjb2xsY3Rpb25zO1xuICAgIH1cblxuICAgIHNldFN1cnZleSh2b3RlU3VydmF5KSB7XG4gICAgICAgIHRoaXMudm90ZVN1cnZheSA9IHZvdGVTdXJ2YXk7XG4gICAgfVxuXG4gICAgc2V0U3VydmV5RGF0YShsYXllciwgZXYpIHtcbiAgICAgICAgdGhpcy52b3RlU3VydmF5LnNldExheWVyRGF0YShsYXllciwgZXYpO1xuICAgIH1cblxuICAgIHNldEFjdGl2ZUFyZWEoKSB7XG4gICAgICAgIGlmICghdGhpcy5tYXAuX2xvYWRlZCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgbGV0IHRvcCA9IDAsXG4gICAgICAgIGJvdHRvbSA9IDAsXG4gICAgICAgIGxlZnQgPSAwLFxuICAgICAgICByaWdodCA9IDA7XG5cbiAgICAgICAgbGV0IGNhbGxjdWxhdGVkV2lkdGggPSAwLFxuICAgICAgICBjYWxsY3VsYXRlZFdpZHRoTGVmdCA9IDAsXG4gICAgICAgIGNhbGxjdWxhdGVkV2lkdGhSaWdodCA9IDAsXG4gICAgICAgIGNhbGxjdWxhdGVkSGVpZ2h0ID0gMCxcbiAgICAgICAgY2FsbGN1bGF0ZWRIZWlnaHRUb3AgPSAwLFxuICAgICAgICBjYWxsY3VsYXRlZEhlaWdodEJvdCA9IDA7XG5cbiAgICAgICAgdGhpcy5hY3RpdmVBcmVhTGlzdC5mb3JFYWNoKGVsID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGVsV2lkdGggPSBwYXJzZUZsb2F0KGdldENvbXB1dGVkU3R5bGUoZWwpLmdldFByb3BlcnR5VmFsdWUoJ3dpZHRoJykpLFxuICAgICAgICAgICAgZWxIZWlnaHQgPSBwYXJzZUZsb2F0KGdldENvbXB1dGVkU3R5bGUoZWwpLmdldFByb3BlcnR5VmFsdWUoJ2hlaWdodCcpKSxcbiAgICAgICAgICAgIGVsVG9wID0gcGFyc2VGbG9hdChnZXRDb21wdXRlZFN0eWxlKGVsKS5nZXRQcm9wZXJ0eVZhbHVlKCd0b3AnKSksXG4gICAgICAgICAgICBlbEJvdHRvbSA9IHBhcnNlRmxvYXQoZ2V0Q29tcHV0ZWRTdHlsZShlbCkuZ2V0UHJvcGVydHlWYWx1ZSgnYm90dG9tJykpLFxuICAgICAgICAgICAgZWxMZWZ0ID0gcGFyc2VGbG9hdChnZXRDb21wdXRlZFN0eWxlKGVsKS5nZXRQcm9wZXJ0eVZhbHVlKCdsZWZ0JykpLFxuICAgICAgICAgICAgZWxSaWdodCA9IHBhcnNlRmxvYXQoZ2V0Q29tcHV0ZWRTdHlsZShlbCkuZ2V0UHJvcGVydHlWYWx1ZSgncmlnaHQnKSk7XG5cbiAgICAgICAgICAgIC8vIE9wdGltaXNlIHRoaXMgY29kZSByZXBldGl0aW9uXG4gICAgICAgICAgICBpZiAoZWwuY2xpZW50V2lkdGggPT09IHdpbmRvdy5pbm5lcldpZHRoKSB7XG4gICAgICAgICAgICAgICAgaWYgKE1hdGgucm91bmQoZWxCb3R0b20pIDw9IDApIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gQm90dG9tXG4gICAgICAgICAgICAgICAgICAgIGlmIChlbEhlaWdodCA+IGNhbGxjdWxhdGVkSGVpZ2h0Qm90KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYWxsY3VsYXRlZEhlaWdodEJvdCA9IGVsSGVpZ2h0O1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChNYXRoLnJvdW5kKGVsVG9wKSA9PT0gMCkge1xuICAgICAgICAgICAgICAgICAgICAvLyBUT1BcbiAgICAgICAgICAgICAgICAgICAgaWYgKGVsSGVpZ2h0ID4gY2FsbGN1bGF0ZWRIZWlnaHRUb3ApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRvcCA9IGVsSGVpZ2h0O1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGN1bGF0ZWRIZWlnaHRUb3AgPSBlbEhlaWdodDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGNhbGxjdWxhdGVkSGVpZ2h0ID0gY2FsbGN1bGF0ZWRIZWlnaHRUb3AgKyBjYWxsY3VsYXRlZEhlaWdodEJvdDtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoZWwuY2xpZW50SGVpZ2h0ID09PSB3aW5kb3cuaW5uZXJIZWlnaHQpIHtcbiAgICAgICAgICAgICAgICBpZiAoTWF0aC5yb3VuZChlbFJpZ2h0KSA8PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIFJpZ2h0XG4gICAgICAgICAgICAgICAgICAgIGlmIChlbFdpZHRoID4gY2FsbGN1bGF0ZWRXaWR0aFJpZ2h0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYWxsY3VsYXRlZFdpZHRoUmlnaHQgPSBlbFdpZHRoO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChNYXRoLnJvdW5kKGVsTGVmdCkgPT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gTGVmdFxuICAgICAgICAgICAgICAgICAgICBpZiAoZWxXaWR0aCA+IGNhbGxjdWxhdGVkV2lkdGhMZWZ0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBsZWZ0ID0gZWxXaWR0aDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxjdWxhdGVkV2lkdGhMZWZ0ID0gZWxXaWR0aDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGNhbGxjdWxhdGVkV2lkdGggPSBjYWxsY3VsYXRlZFdpZHRoTGVmdCArIGNhbGxjdWxhdGVkV2lkdGhSaWdodDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgY29uc3Qgd2lkdGggPSB3aW5kb3cuaW5uZXJXaWR0aCAtIGNhbGxjdWxhdGVkV2lkdGg7XG4gICAgICAgIGNvbnN0IGhlaWdodCA9IHdpbmRvdy5pbm5lckhlaWdodCAtIGNhbGxjdWxhdGVkSGVpZ2h0O1xuXG4gICAgICAgIGNvbnN0IGxhc3RDZW50ZXJQb2ludCA9IHRoaXMubWFwLmdldENlbnRlcigpO1xuXG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5tYXAucGFuVG8obGFzdENlbnRlclBvaW50KTtcbiAgICAgICAgfSwgMjAwKTtcblxuICAgICAgICB0aGlzLm1hcC5zZXRBY3RpdmVBcmVhKHtcbiAgICAgICAgICAgIC4uLmRlZmF1bHRPYmplY3RTdHlsZS5tYXBBY3RpdmVBcmVhLFxuICAgICAgICAgICAgd2lkdGg6IHdpZHRoICsgJ3B4JyxcbiAgICAgICAgICAgIGhlaWdodDogaGVpZ2h0ICsgJ3B4JyxcbiAgICAgICAgICAgIHRvcDogdG9wICsgJ3B4JyxcbiAgICAgICAgICAgIGJvdHRvbTogYm90dG9tICsgJ3B4JyxcbiAgICAgICAgICAgIGxlZnQ6IGxlZnQgKyAncHgnLFxuICAgICAgICAgICAgcmlnaHQ6IHJpZ2h0ICsgJ3B4JyxcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgYWRkVG9BY3RpdmVBcmVhTGlzdChhY3RpdmVBcmVhQ29uZmlnKSB7XG4gICAgICAgIGlmICghdGhpcy5hY3RpdmVBcmVhTGlzdC5pbmNsdWRlcyhhY3RpdmVBcmVhQ29uZmlnKSkge1xuICAgICAgICAgICAgdGhpcy5hY3RpdmVBcmVhTGlzdC5wdXNoKGFjdGl2ZUFyZWFDb25maWcpO1xuICAgICAgICAgICAgdGhpcy5zZXRBY3RpdmVBcmVhKCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICByZW1vdmVGcm9tQWN0aXZlQXJlYUxpc3QoYWN0aXZlQXJlYUNvbmZpZykge1xuICAgICAgICBjb25zdCBpbmRleCA9IHRoaXMuYWN0aXZlQXJlYUxpc3QuaW5kZXhPZihhY3RpdmVBcmVhQ29uZmlnKTtcblxuICAgICAgICBpZiAoaW5kZXggPiAtMSkge1xuICAgICAgICAgICAgdGhpcy5hY3RpdmVBcmVhTGlzdC5zcGxpY2UoaW5kZXgsIDEpO1xuICAgICAgICAgICAgdGhpcy5zZXRBY3RpdmVBcmVhKCk7XG4gICAgICAgIH1cbiAgICB9XG59O1xuXG4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFBQTtBQUNBOzs7QUFBQTtBQUNBO0FBQ0E7QUFnQkE7QUFBQTtBQUNBO0FBREE7QUFBQTtBQUFBO0FBVEE7QUFDQTtBQUNBO0FBQ0E7QUFKQTtBQVVBO0FBQUE7QUFDQTtBQUNBOzs7QUFDQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBUkE7QUFVQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBREE7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBWEE7QUFhQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQVBBO0FBU0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBckNBO0FBQ0E7QUF3Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBUEE7QUFTQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFyQ0E7QUFDQTtBQXVDQTtBQUNBOzs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFGQTtBQUNBO0FBSUE7QUFDQTtBQUNBOzs7QUFFQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUVBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUVBO0FBQ0E7QUFDQTtBQURBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFJQTtBQUNBO0FBTkE7QUFDQTtBQVFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQVJBO0FBU0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBL0JBO0FBaUNBOzs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRkE7QUFDQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBSEE7QUFPQTs7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUZBO0FBSUE7OztBQUVBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFOQTtBQUNBO0FBUUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBTEE7QUFDQTtBQU9BO0FBQ0E7QUFEQTtBQUdBO0FBQ0E7OztBQUVBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFQQTtBQVNBOzs7QUFFQTtBQUNBO0FBQ0E7OztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBVkE7QUFZQTs7O0FBRUE7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFFQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUpBO0FBQ0E7QUFNQTtBQUNBO0FBT0E7QUFDQTtBQUNBO0FBQ0E7QUFEQTtBQUdBO0FBQ0E7QUFDQTs7O0FBRUE7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUpBO0FBQ0E7QUFNQTtBQUNBO0FBY0E7QUFDQTtBQUNBO0FBQ0E7QUFEQTtBQUdBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUNBOzs7QUFFQTtBQUNBO0FBQ0E7OztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQVRBO0FBV0E7OztBQUVBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUNBOzs7QUFFQTtBQUNBO0FBQ0E7OztBQUVBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUlBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBTUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQU1BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFQQTtBQVNBOzs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7OztBQUNBIiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///4\n")},function(module,exports,__webpack_require__){"use strict";eval('\n\nObject.defineProperty(exports, "__esModule", {\n    value: true\n});\nvar _arguments = arguments;\nvar debounce = exports.debounce = function debounce(func, wait) {\n    var immediate = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n\n    var timeout = void 0;\n    return function (e) {\n        var later = function later() {\n            timeout = null;\n            if (!immediate) {\n                func.apply(undefined, [e].concat(Array.prototype.slice.call(_arguments)));\n            }\n        };\n\n        var callNow = immediate && !timeout;\n        clearTimeout(timeout);\n        timeout = setTimeout(later, wait);\n\n        if (callNow) {\n            func.apply(undefined, [e].concat(Array.prototype.slice.call(_arguments)));\n        }\n    };\n};//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNS5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy9hc3NldHMvZnJvbnQvanMvaGVscGVycy5qcz84ZWNkIl0sInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCBjb25zdCBkZWJvdW5jZSA9IChmdW5jLCB3YWl0LCBpbW1lZGlhdGUgPSBmYWxzZSkgPT4ge1xuICAgIGxldCB0aW1lb3V0O1xuICAgIHJldHVybiAoZSkgPT4ge1xuICAgICAgICBjb25zdCBsYXRlciA9ICgpID0+IHtcbiAgICAgICAgICAgIHRpbWVvdXQgPSBudWxsO1xuICAgICAgICAgICAgaWYgKCFpbW1lZGlhdGUpIHtcbiAgICAgICAgICAgICAgICBmdW5jLmFwcGx5KHRoaXMsIFtlLCAuLi5hcmd1bWVudHNdKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICBjb25zdCBjYWxsTm93ID0gaW1tZWRpYXRlICYmICF0aW1lb3V0O1xuICAgICAgICBjbGVhclRpbWVvdXQodGltZW91dCk7XG4gICAgICAgIHRpbWVvdXQgPSBzZXRUaW1lb3V0KGxhdGVyLCB3YWl0KTtcblxuICAgICAgICBpZiAoY2FsbE5vdykge1xuICAgICAgICAgICAgZnVuYy5hcHBseSh0aGlzLCBbZSwgLi4uYXJndW1lbnRzXSk7XG4gICAgICAgIH1cbiAgICB9O1xufSJdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///5\n')},function(module,exports,__webpack_require__){"use strict";eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\nexports.Survey = undefined;\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _mapConfig = __webpack_require__(0);\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar Survey = exports.Survey = function () {\n    function Survey(mapInstance) {\n        _classCallCheck(this, Survey);\n\n        this.geoObjectUUID = '';\n        this.isOpen = false;\n        this.progress = 0;\n        this.questions = [];\n        this.results = {\n            rating: [{}],\n            respondents: [{}]\n        };\n        this.mapMarkerIcon = L.icon({\n            iconUrl: 'front/svg/icon--map-pin--edit.svg',\n            iconSize: [53.707, 53.707], // size of the icon\n            iconAnchor: [26.9, 53] // point of the icon which will correspond to marker's location\n        });\n\n        this.mapInstance = mapInstance;\n        this.init();\n    }\n\n    // UI\n\n\n    _createClass(Survey, [{\n        key: 'init',\n        value: function init() {\n            this.queryElements();\n            this.events();\n        }\n    }, {\n        key: 'queryElements',\n        value: function queryElements() {\n            this.elPathVoteSurveyContainer = document.getElementById('path-vote-survey');\n            if (!this.elPathVoteSurveyContainer) {\n                throw 'Element \"#path-vote-survey\" not found';\n            }\n            this.elProgressBar = this.elPathVoteSurveyContainer.querySelector('.survey-progress-bar');\n            this.elSurveayForm = this.elPathVoteSurveyContainer.querySelector('.survey-form');\n\n            this.elSurveyCarouselNav = this.elPathVoteSurveyContainer.querySelectorAll('.side-panel-nav-btn');\n            this.elSurveyPollBtn = this.elSurveyCarouselNav[1];\n            this.refSurveyCarousel = this.elPathVoteSurveyContainer.querySelectorAll('#carousel-survey-pages');\n        }\n    }, {\n        key: 'events',\n        value: function events() {\n            var _this = this;\n\n            $(this.elSurveyCarouselNav).on('click', function (e) {\n                if (e.currentTarget.classList.contains('active')) {\n                    return false;\n                }\n                _this.elSurveyCarouselNav.forEach(function (navItem) {\n                    navItem.classList.remove('active');\n                });\n                e.currentTarget.classList.add('active');\n            });\n\n            $(document).on('click', '[data-toggle-for=\"path-vote-survey\"][data-toggle-open]', function () {\n                _this.open(_this.layer, _this.ev);\n            });\n\n            $(document).on('click', '[data-toggle-for=\"path-vote-survey\"][data-toggle-close]', function () {\n                _this.close();\n            });\n\n            $(document).on('input propertychange', '.survey-question-input', function (e) {\n                var target = e.target;\n                var data = {};\n                var debounceTime = 0;\n\n                if (target.tagName === 'TEXTAREA') {\n                    data = {\n                        'explanation': {\n                            'answer': target.id,\n                            'text': target.value\n                        }\n                    };\n\n                    debounceTime = 400;\n                } else {\n                    data = {\n                        'answer': target.value\n                    };\n                }\n\n                clearTimeout(_this.timeoutId);\n\n                _this.timeoutId = setTimeout(function () {\n                    _this.submitSurvey(data, target.value);\n                }, debounceTime);\n            });\n\n            $(document).on('click', '.survey-question .remove', function (e) {\n                var uuid = e.currentTarget.getAttribute('data-uuid');\n                _this.clearQuestion(uuid);\n            });\n        }\n    }, {\n        key: 'getQuestions',\n        value: function getQuestions() {\n            var _this2 = this;\n\n            $.ajax({\n                url: 'front-end/geo/' + this.geoObjectUUID,\n                success: function success(result) {\n                    _this2.buildSurvey(result);\n                }\n            });\n        }\n    }, {\n        key: 'getResults',\n        value: function getResults() {\n            var _this3 = this;\n\n            $.ajax({\n                url: 'front-end/geo/' + this.geoObjectUUID + '/result',\n                success: function success(result) {\n                    _this3.buildResults(result);\n                }\n            });\n        }\n    }, {\n        key: 'submitSurvey',\n        value: function submitSurvey(data, value) {\n            var _this4 = this;\n\n            $.ajax({\n                type: 'POST',\n                url: '/geo/' + this.geoObjectUUID + '/q',\n                data: data,\n                beforeSend: function beforeSend() {\n                    if (document.getElementById(value)) {\n                        document.getElementById(value).classList.add('active');\n                    }\n                },\n                success: function success(result) {\n                    _this4.buildSurvey(result);\n                    _this4.getResults();\n                }\n            });\n        }\n    }, {\n        key: 'buildResults',\n        value: function buildResults(result) {\n            var _this5 = this;\n\n            var ratingHTML = '';\n            var respondentsHTML = '';\n            var isSelectedParent = false;\n            this.results.rating = result.rating;\n            this.results.respondents = result.respondents;\n\n            this.results.rating.forEach(function (ratingItem) {\n                ratingHTML += '\\n                <div class=\"row\">\\n                    <div class=\"col-lg-6 text-right\">' + ratingItem.criterion + '</div>\\n                    <div class=\"col-lg-6\">\\n                        <div class=\"progress mb-4\">\\n                            <div class=\"progress-bar pt-1\" role=\"progressbar\" style=\"width: ' + ratingItem.percentage + '%;\"\\n                                aria-valuenow=\"' + ratingItem.percentage + '\" aria-valuemin=\"0\"\\n                                aria-valuemax=\"100\">' + ratingItem.rating + ' / ' + ratingItem.max + '</div>\\n                        </div>\\n                    </div>\\n                </div>';\n            });\n\n            document.querySelector('.survey-ratings-rating').innerHTML = ratingHTML;\n\n            Object.keys(this.results.respondents).forEach(function (respondentUser) {\n                respondentsHTML += '<strong>' + respondentUser + '</strong>';\n\n                _this5.results.respondents[respondentUser].forEach(function (respondentItem) {\n                    respondentsHTML += '\\n                    <div class=\"row\">\\n                        <div class=\"col-lg-6 text-right\">' + respondentItem.criterion + '</div>\\n                        <div class=\"col-lg-6\">\\n                            <div class=\"progress mb-4\">\\n                                <div class=\"progress-bar pt-1\" role=\"progressbar\" style=\"width: ' + respondentItem.percentage + '%;\"\\n                                     aria-valuenow=\"' + respondentItem.percentage + '\" aria-valuemin=\"0\"\\n                                     aria-valuemax=\"100\">' + respondentItem.rating + ' / ' + respondentItem.max + '</div>\\n                            </div>\\n                        </div>\\n                    </div>';\n                });\n            });\n\n            document.querySelector('.survey-ratings-respondents').innerHTML = ratingHTML;\n        }\n    }, {\n        key: 'buildSurvey',\n        value: function buildSurvey(result) {\n            var _this6 = this;\n\n            var html = '';\n            var isSelectedParent = false;\n            this.progress = result.survey.progress;\n            this.questions = result.survey.questions;\n\n            Object.keys(this.questions).forEach(function (item) {\n                var answers = _this6.questions[item].answers;\n                _this6.question = _this6.questions[item];\n\n                var isAnswered = _this6.question.isAnswered && _this6.question.isCompleted;\n                var isUnComplete = _this6.question.isAnswered && !_this6.question.isCompleted;\n\n                html += '<div class=\"survey-question mb-4 ' + (isAnswered ? 'is-answered' : isUnComplete ? 'is-unComplete' : null) + '\">';\n\n                html += '\\n                <div class=\"survey-question-title mb-1\">\\n                    <h6 class=\"survey-question-title-text d-inline\">' + _this6.question.title + '</h6>\\n                    <div class=\"d-flex flex-grow-1 align-items-start justify-content-end\">\\n                        <button type=\"button\" class=\"remove btn btn-sm btn-danger\" name=\"answers[option][' + _this6.question.uuid + '][]\" data-uuid=\"' + _this6.question.uuid + '\">\\n                            <i class=\"fa fa-trash\"></i>\\n                        </button>\\n                    </div>\\n                </div>\\n            ';\n\n                html += '\\n                <div class=\"survey-question pl-1\">\\n            ';\n\n                Object.keys(answers).forEach(function (answer) {\n                    if (answers[answer].parent === null) {\n                        isSelectedParent = _this6.question.answers[answer].isSelected;\n\n                        html += '<div class=\"d-flex flex-column\">\\n                                <label class=\"survey-question-option ' + (answers[answer].isSelected ? 'is-selected' : '') + '\" id=\"' + answers[answer].uuid + '\">\\n                                    <input class=\"mr-1 survey-question-input\" type=\"' + (_this6.question.hasMultipleAnswers ? 'checkbox' : 'radio') + '\" name=\"answers[option][' + _this6.question.uuid + '][]\"\\n                                    ' + (answers[answer].isSelected ? 'checked=\"checked\"' : '') + ' value=\"' + answers[answer].uuid + '\" /> ' + answers[answer].title + '\\n                                </label>\\n                            </div>';\n\n                        if (_this6.question.answers[answer].isFreeAnswer) {\n                            html += '<textarea class=\"survey-question-input\"></textarea>';\n                        }\n                    } else {\n                        if (isSelectedParent === true) {\n                            html += '<div class=\"pl-4 d-flex flex-column\">\\n                                    <label class=\"survey-question-option ' + (answers[answer].isSelected ? 'is-selected' : '') + '\" id=\"' + answers[answer].uuid + '\">\\n                                        <input class=\"mr-1 survey-question-input\" type=\"checkbox\" name=\"answers[option][' + _this6.question.uuid + ('][]\" ' + (answers[answer].isSelected ? 'checked=\"checked\"' : '') + ' value=\"' + answers[answer].uuid + '\" />\\n                                        ') + answers[answer].title + '</label>';\n\n                            if (answers[answer].isSelected && _this6.question.answers[answer].isFreeAnswer) {\n                                html += '<label class=\"' + (answers[answer].isSelected ? 'is-selected' : '') + '\">\\n                                        <textarea class=\"survey-question-input d-block\" id=\"textarea-' + _this6.question.answers[answer].uuid + ']\">' + _this6.question.answers[answer].explanation + '</textarea>\\n                                    </label>';\n                            }\n\n                            html += '</div>';\n                        }\n                    }\n                });\n\n                html += '\\n                    </div>\\n                </div>\\n            ';\n            });\n\n            this.elSurveayForm.innerHTML = html;\n\n            this.elProgressBar.style.width = this.progress.percentage + '%';\n\n            if (this.progress.percentage === 100) {\n                this.elSurveyPollBtn.classList.remove('disabled');\n                $(this.elSurveyPollBtn).parent().tooltip('disable');\n            } else {\n                this.elSurveyPollBtn.classList.add('disabled');\n                $(this.elSurveyPollBtn).parent().tooltip('enable');\n            }\n        }\n    }, {\n        key: 'setLayerData',\n        value: function setLayerData(layer, ev) {\n            this.layer = layer;\n            this.event = ev;\n            this.geoObjectUUID = this.layer.feature.properties.id;\n            this.getQuestions();\n            this.getResults();\n        }\n    }, {\n        key: 'addMarker',\n        value: function addMarker() {\n            this.removeMarker();\n            this.mapMarker = L.marker(this.layer.getCenter(), {\n                icon: this.mapMarkerIcon\n            });\n            this.mapMarker.addTo(this.mapInstance.map);\n        }\n    }, {\n        key: 'removeMarker',\n        value: function removeMarker() {\n            if (this.mapMarker) {\n                this.mapMarker.remove();\n            }\n        }\n    }, {\n        key: 'open',\n        value: function open(layer, ev) {\n            this.isOpen = true;\n            this.mapInstance.map.closePopup();\n            this.mapInstance.setLayerActiveStyle(this.layer);\n            this.mapInstance.toggleHeaderEl(false);\n            this.addMarker();\n\n            if (layer && ev) {\n                this.setLayerData(layer, ev);\n            }\n\n            this.elPathVoteSurveyContainer.querySelector('.geo-object-name').textContent = this.layer.feature.properties.name;\n            this.elPathVoteSurveyContainer.querySelector('.geo-object-type').textContent = this.layer.feature.properties.type;\n            this.mapInstance.addToActiveAreaList(this.elPathVoteSurveyContainer);\n        }\n    }, {\n        key: 'close',\n        value: function close() {\n            this.isOpen = false;\n            this.removeMarker();\n            this.mapInstance.toggleHeaderEl(true);\n            this.mapInstance.removeFromActiveAreaList(this.elPathVoteSurveyContainer);\n        }\n    }, {\n        key: 'clearQuestion',\n        value: function clearQuestion(uuid) {\n            var _this7 = this;\n\n            $.ajax({\n                type: 'POST',\n                url: '/geo/' + this.geoObjectUUID + '/clear/' + uuid,\n                success: function success() {\n                    _this7.getQuestions();\n                    _this7.getResults();\n                }\n            });\n        }\n    }]);\n\n    return Survey;\n}();\n\n;//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNi5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy9hc3NldHMvZnJvbnQvanMvc3VydmV5LmpzPzhjNTciXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgZGVmYXVsdE1hcFNpemUgfSBmcm9tICcuL21hcC1jb25maWcnO1xuXG5leHBvcnQgY2xhc3MgU3VydmV5IHtcbiAgICBtYXBJbnN0YW5jZTtcbiAgICBsYXllcjtcbiAgICBnZW9PYmplY3RVVUlEID0gJyc7XG4gICAgaXNPcGVuID0gZmFsc2U7XG4gICAgbWFwTWFya2VyO1xuXG4gICAgdGltZW91dElkO1xuICAgIHByb2dyZXNzID0gMDtcbiAgICBxdWVzdGlvbnMgPSBbXTtcbiAgICByZXN1bHRzID0ge1xuICAgICAgICByYXRpbmc6IFt7fV0sXG4gICAgICAgIHJlc3BvbmRlbnRzOiBbe31dXG4gICAgfTtcblxuICAgIG1hcE1hcmtlckljb24gPSBMLmljb24oe1xuICAgICAgICBpY29uVXJsOiAnZnJvbnQvc3ZnL2ljb24tLW1hcC1waW4tLWVkaXQuc3ZnJyxcbiAgICAgICAgaWNvblNpemU6ICAgICBbNTMuNzA3LCA1My43MDddLCAvLyBzaXplIG9mIHRoZSBpY29uXG4gICAgICAgIGljb25BbmNob3I6ICAgWzI2LjksIDUzXSwgLy8gcG9pbnQgb2YgdGhlIGljb24gd2hpY2ggd2lsbCBjb3JyZXNwb25kIHRvIG1hcmtlcidzIGxvY2F0aW9uXG4gICAgfSk7XG5cbiAgICAvLyBVSVxuICAgIGV2ZW50O1xuICAgIGVsUGF0aFZvdGVTdXJ2ZXlDb250YWluZXI7XG4gICAgZWxQcm9ncmVzc0JhcjtcbiAgICBlbFN1cnZlYXlGb3JtO1xuICAgIGVsU3VydmV5Q2Fyb3VzZWxOYXY7XG4gICAgZWxTdXJ2ZXlQb2xsQnRuO1xuICAgIHJlZlN1cnZleUNhcm91c2VsO1xuXG4gICAgY29uc3RydWN0b3IobWFwSW5zdGFuY2UpIHtcbiAgICAgICAgdGhpcy5tYXBJbnN0YW5jZSA9IG1hcEluc3RhbmNlO1xuICAgICAgICB0aGlzLmluaXQoKTtcbiAgICB9XG5cbiAgICBpbml0KCkge1xuICAgICAgICB0aGlzLnF1ZXJ5RWxlbWVudHMoKTtcbiAgICAgICAgdGhpcy5ldmVudHMoKTtcbiAgICB9XG5cbiAgICBxdWVyeUVsZW1lbnRzKCkge1xuICAgICAgICB0aGlzLmVsUGF0aFZvdGVTdXJ2ZXlDb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGF0aC12b3RlLXN1cnZleScpO1xuICAgICAgICBpZiAoIXRoaXMuZWxQYXRoVm90ZVN1cnZleUNvbnRhaW5lcikge1xuICAgICAgICAgICB0aHJvdyAnRWxlbWVudCBcIiNwYXRoLXZvdGUtc3VydmV5XCIgbm90IGZvdW5kJztcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmVsUHJvZ3Jlc3NCYXIgPSB0aGlzLmVsUGF0aFZvdGVTdXJ2ZXlDb250YWluZXIucXVlcnlTZWxlY3RvcignLnN1cnZleS1wcm9ncmVzcy1iYXInKTtcbiAgICAgICAgdGhpcy5lbFN1cnZlYXlGb3JtID0gdGhpcy5lbFBhdGhWb3RlU3VydmV5Q29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoJy5zdXJ2ZXktZm9ybScpO1xuXG4gICAgICAgIHRoaXMuZWxTdXJ2ZXlDYXJvdXNlbE5hdiA9IHRoaXMuZWxQYXRoVm90ZVN1cnZleUNvbnRhaW5lci5xdWVyeVNlbGVjdG9yQWxsKCcuc2lkZS1wYW5lbC1uYXYtYnRuJyk7XG4gICAgICAgIHRoaXMuZWxTdXJ2ZXlQb2xsQnRuID0gdGhpcy5lbFN1cnZleUNhcm91c2VsTmF2WzFdO1xuICAgICAgICB0aGlzLnJlZlN1cnZleUNhcm91c2VsID0gdGhpcy5lbFBhdGhWb3RlU3VydmV5Q29udGFpbmVyLnF1ZXJ5U2VsZWN0b3JBbGwoJyNjYXJvdXNlbC1zdXJ2ZXktcGFnZXMnKTtcbiAgICB9XG5cbiAgICBldmVudHMoKSB7XG4gICAgICAgICQodGhpcy5lbFN1cnZleUNhcm91c2VsTmF2KS5vbignY2xpY2snLCAoZSkgPT4ge1xuICAgICAgICAgICAgaWYgKGUuY3VycmVudFRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ2FjdGl2ZScpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5lbFN1cnZleUNhcm91c2VsTmF2LmZvckVhY2goKG5hdkl0ZW0pID0+IHtcbiAgICAgICAgICAgICAgICBuYXZJdGVtLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIGUuY3VycmVudFRhcmdldC5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKVxuICAgICAgICB9KTtcblxuXG4gICAgICAgICQoZG9jdW1lbnQpLm9uKCdjbGljaycsICdbZGF0YS10b2dnbGUtZm9yPVwicGF0aC12b3RlLXN1cnZleVwiXVtkYXRhLXRvZ2dsZS1vcGVuXScsICgpID0+IHtcbiAgICAgICAgICAgIHRoaXMub3Blbih0aGlzLmxheWVyLCB0aGlzLmV2KTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgJChkb2N1bWVudCkub24oJ2NsaWNrJywgJ1tkYXRhLXRvZ2dsZS1mb3I9XCJwYXRoLXZvdGUtc3VydmV5XCJdW2RhdGEtdG9nZ2xlLWNsb3NlXScsICgpID0+IHtcbiAgICAgICAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgJChkb2N1bWVudCkub24oJ2lucHV0IHByb3BlcnR5Y2hhbmdlJywgJy5zdXJ2ZXktcXVlc3Rpb24taW5wdXQnLCAoZSkgPT4ge1xuICAgICAgICAgICAgY29uc3QgdGFyZ2V0ID0gZS50YXJnZXQ7XG4gICAgICAgICAgICBsZXQgZGF0YSA9IHt9O1xuICAgICAgICAgICAgbGV0IGRlYm91bmNlVGltZSA9IDA7XG5cbiAgICAgICAgICAgIGlmICh0YXJnZXQudGFnTmFtZSA9PT0gJ1RFWFRBUkVBJykge1xuICAgICAgICAgICAgICAgIGRhdGEgPSB7XG4gICAgICAgICAgICAgICAgICAgICdleHBsYW5hdGlvbic6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICdhbnN3ZXInOiB0YXJnZXQuaWQsXG4gICAgICAgICAgICAgICAgICAgICAgICAndGV4dCc6IHRhcmdldC52YWx1ZSxcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICBkZWJvdW5jZVRpbWUgPSA0MDA7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGRhdGEgPSB7XG4gICAgICAgICAgICAgICAgICAgICdhbnN3ZXInOiB0YXJnZXQudmFsdWUsXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRoaXMudGltZW91dElkKTtcblxuICAgICAgICAgICAgdGhpcy50aW1lb3V0SWQgPSBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLnN1Ym1pdFN1cnZleShkYXRhLCB0YXJnZXQudmFsdWUpXG4gICAgICAgICAgICB9LCBkZWJvdW5jZVRpbWUpO1xuICAgICAgICB9KTtcblxuICAgICAgICAkKGRvY3VtZW50KS5vbignY2xpY2snLCAnLnN1cnZleS1xdWVzdGlvbiAucmVtb3ZlJywgKGUpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHV1aWQgPSBlLmN1cnJlbnRUYXJnZXQuZ2V0QXR0cmlidXRlKCdkYXRhLXV1aWQnKTtcbiAgICAgICAgICAgIHRoaXMuY2xlYXJRdWVzdGlvbih1dWlkKTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgZ2V0UXVlc3Rpb25zKCkge1xuICAgICAgICAkLmFqYXgoe1xuICAgICAgICAgICAgdXJsOiAnZnJvbnQtZW5kL2dlby8nICsgdGhpcy5nZW9PYmplY3RVVUlELFxuICAgICAgICAgICAgc3VjY2VzczogKHJlc3VsdCkgPT4ge1xuICAgICAgICAgICAgICAgdGhpcy5idWlsZFN1cnZleShyZXN1bHQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBnZXRSZXN1bHRzKCkge1xuICAgICAgICAkLmFqYXgoe1xuICAgICAgICAgICAgdXJsOiAnZnJvbnQtZW5kL2dlby8nICsgdGhpcy5nZW9PYmplY3RVVUlEICsgJy9yZXN1bHQnLFxuICAgICAgICAgICAgc3VjY2VzczogKHJlc3VsdCkgPT4ge1xuICAgICAgICAgICAgICAgdGhpcy5idWlsZFJlc3VsdHMocmVzdWx0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgc3VibWl0U3VydmV5KGRhdGEsIHZhbHVlKSB7XG4gICAgICAgICQuYWpheCh7XG4gICAgICAgICAgICB0eXBlOiAnUE9TVCcsXG4gICAgICAgICAgICB1cmw6ICcvZ2VvLycgKyB0aGlzLmdlb09iamVjdFVVSUQgKyAnL3EnLFxuICAgICAgICAgICAgZGF0YTogZGF0YSxcbiAgICAgICAgICAgIGJlZm9yZVNlbmQ6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQodmFsdWUpKSB7XG4gICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHZhbHVlKS5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc3VjY2VzczogKHJlc3VsdCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuYnVpbGRTdXJ2ZXkocmVzdWx0KTtcbiAgICAgICAgICAgICAgICB0aGlzLmdldFJlc3VsdHMoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgIGJ1aWxkUmVzdWx0cyhyZXN1bHQpIHtcbiAgICAgICAgbGV0IHJhdGluZ0hUTUwgPSBgYDtcbiAgICAgICAgbGV0IHJlc3BvbmRlbnRzSFRNTCA9IGBgO1xuICAgICAgICBsZXQgaXNTZWxlY3RlZFBhcmVudCA9IGZhbHNlO1xuICAgICAgICB0aGlzLnJlc3VsdHMucmF0aW5nID0gcmVzdWx0LnJhdGluZztcbiAgICAgICAgdGhpcy5yZXN1bHRzLnJlc3BvbmRlbnRzID0gcmVzdWx0LnJlc3BvbmRlbnRzO1xuXG4gICAgICAgdGhpcy5yZXN1bHRzLnJhdGluZy5mb3JFYWNoKChyYXRpbmdJdGVtKSA9PiB7XG4gICAgICAgICAgICByYXRpbmdIVE1MICs9IGBcbiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwicm93XCI+XG4gICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJjb2wtbGctNiB0ZXh0LXJpZ2h0XCI+JHtyYXRpbmdJdGVtLmNyaXRlcmlvbn08L2Rpdj5cbiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cImNvbC1sZy02XCI+XG4gICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwicHJvZ3Jlc3MgbWItNFwiPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJwcm9ncmVzcy1iYXIgcHQtMVwiIHJvbGU9XCJwcm9ncmVzc2JhclwiIHN0eWxlPVwid2lkdGg6ICR7cmF0aW5nSXRlbS5wZXJjZW50YWdlfSU7XCJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJpYS12YWx1ZW5vdz1cIiR7cmF0aW5nSXRlbS5wZXJjZW50YWdlfVwiIGFyaWEtdmFsdWVtaW49XCIwXCJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJpYS12YWx1ZW1heD1cIjEwMFwiPiR7cmF0aW5nSXRlbS5yYXRpbmd9IC8gJHtyYXRpbmdJdGVtLm1heH08L2Rpdj5cbiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgICA8L2Rpdj5gO1xuICAgICAgICB9KTtcblxuICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc3VydmV5LXJhdGluZ3MtcmF0aW5nJykuaW5uZXJIVE1MID0gcmF0aW5nSFRNTDtcblxuICAgICAgICBPYmplY3Qua2V5cyh0aGlzLnJlc3VsdHMucmVzcG9uZGVudHMpLmZvckVhY2goKHJlc3BvbmRlbnRVc2VyKSA9PiB7XG4gICAgICAgICAgICByZXNwb25kZW50c0hUTUwgKz0gYDxzdHJvbmc+JHtyZXNwb25kZW50VXNlcn08L3N0cm9uZz5gO1xuXG4gICAgICAgICAgICB0aGlzLnJlc3VsdHMucmVzcG9uZGVudHNbcmVzcG9uZGVudFVzZXJdLmZvckVhY2goKHJlc3BvbmRlbnRJdGVtKSA9PiB7XG4gICAgICAgICAgICAgICAgcmVzcG9uZGVudHNIVE1MICs9IGBcbiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cInJvd1wiPlxuICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cImNvbC1sZy02IHRleHQtcmlnaHRcIj4ke3Jlc3BvbmRlbnRJdGVtLmNyaXRlcmlvbn08L2Rpdj5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJjb2wtbGctNlwiPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJwcm9ncmVzcyBtYi00XCI+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJwcm9ncmVzcy1iYXIgcHQtMVwiIHJvbGU9XCJwcm9ncmVzc2JhclwiIHN0eWxlPVwid2lkdGg6ICR7cmVzcG9uZGVudEl0ZW0ucGVyY2VudGFnZX0lO1wiXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJpYS12YWx1ZW5vdz1cIiR7cmVzcG9uZGVudEl0ZW0ucGVyY2VudGFnZX1cIiBhcmlhLXZhbHVlbWluPVwiMFwiXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJpYS12YWx1ZW1heD1cIjEwMFwiPiR7cmVzcG9uZGVudEl0ZW0ucmF0aW5nfSAvICR7cmVzcG9uZGVudEl0ZW0ubWF4fTwvZGl2PlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgICAgIDwvZGl2PmA7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnN1cnZleS1yYXRpbmdzLXJlc3BvbmRlbnRzJykuaW5uZXJIVE1MID0gcmF0aW5nSFRNTDtcblxuICAgIH1cblxuICAgIGJ1aWxkU3VydmV5KHJlc3VsdCkge1xuICAgICAgICBsZXQgaHRtbCA9IGBgO1xuICAgICAgICBsZXQgaXNTZWxlY3RlZFBhcmVudCA9IGZhbHNlO1xuICAgICAgICB0aGlzLnByb2dyZXNzID0gcmVzdWx0LnN1cnZleS5wcm9ncmVzcztcbiAgICAgICAgdGhpcy5xdWVzdGlvbnMgPSByZXN1bHQuc3VydmV5LnF1ZXN0aW9ucztcblxuICAgICAgICBPYmplY3Qua2V5cyh0aGlzLnF1ZXN0aW9ucykuZm9yRWFjaCgoaXRlbSkgPT4ge1xuICAgICAgICAgICAgY29uc3QgYW5zd2VycyA9IHRoaXMucXVlc3Rpb25zW2l0ZW1dLmFuc3dlcnM7XG4gICAgICAgICAgICB0aGlzLnF1ZXN0aW9uID0gdGhpcy5xdWVzdGlvbnNbaXRlbV07XG5cbiAgICAgICAgICAgIGNvbnN0IGlzQW5zd2VyZWQgPSB0aGlzLnF1ZXN0aW9uLmlzQW5zd2VyZWQgJiYgdGhpcy5xdWVzdGlvbi5pc0NvbXBsZXRlZDtcbiAgICAgICAgICAgIGNvbnN0IGlzVW5Db21wbGV0ZSA9IHRoaXMucXVlc3Rpb24uaXNBbnN3ZXJlZCAmJiAhdGhpcy5xdWVzdGlvbi5pc0NvbXBsZXRlZDtcblxuICAgICAgICAgICAgaHRtbCArPSBgPGRpdiBjbGFzcz1cInN1cnZleS1xdWVzdGlvbiBtYi00ICR7aXNBbnN3ZXJlZCA/ICdpcy1hbnN3ZXJlZCcgOiBpc1VuQ29tcGxldGUgPyAnaXMtdW5Db21wbGV0ZScgOiBudWxsfVwiPmA7XG5cbiAgICAgICAgICAgIGh0bWwgKz0gYFxuICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJzdXJ2ZXktcXVlc3Rpb24tdGl0bGUgbWItMVwiPlxuICAgICAgICAgICAgICAgICAgICA8aDYgY2xhc3M9XCJzdXJ2ZXktcXVlc3Rpb24tdGl0bGUtdGV4dCBkLWlubGluZVwiPiR7dGhpcy5xdWVzdGlvbi50aXRsZX08L2g2PlxuICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwiZC1mbGV4IGZsZXgtZ3Jvdy0xIGFsaWduLWl0ZW1zLXN0YXJ0IGp1c3RpZnktY29udGVudC1lbmRcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxidXR0b24gdHlwZT1cImJ1dHRvblwiIGNsYXNzPVwicmVtb3ZlIGJ0biBidG4tc20gYnRuLWRhbmdlclwiIG5hbWU9XCJhbnN3ZXJzW29wdGlvbl1bJHt0aGlzLnF1ZXN0aW9uLnV1aWR9XVtdXCIgZGF0YS11dWlkPVwiJHt0aGlzLnF1ZXN0aW9uLnV1aWR9XCI+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPGkgY2xhc3M9XCJmYSBmYS10cmFzaFwiPjwvaT5cbiAgICAgICAgICAgICAgICAgICAgICAgIDwvYnV0dG9uPlxuICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgIGA7XG5cbiAgICAgICAgICAgIGh0bWwgKz0gYFxuICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJzdXJ2ZXktcXVlc3Rpb24gcGwtMVwiPlxuICAgICAgICAgICAgYDtcblxuICAgICAgICAgICAgT2JqZWN0LmtleXMoYW5zd2VycykuZm9yRWFjaCgoYW5zd2VyKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKGFuc3dlcnNbYW5zd2VyXS5wYXJlbnQgPT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgaXNTZWxlY3RlZFBhcmVudCA9IHRoaXMucXVlc3Rpb24uYW5zd2Vyc1thbnN3ZXJdLmlzU2VsZWN0ZWQ7XG5cbiAgICAgICAgICAgICAgICAgICAgaHRtbCArPSBgPGRpdiBjbGFzcz1cImQtZmxleCBmbGV4LWNvbHVtblwiPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8bGFiZWwgY2xhc3M9XCJzdXJ2ZXktcXVlc3Rpb24tb3B0aW9uIGAgKyAoYW5zd2Vyc1thbnN3ZXJdLmlzU2VsZWN0ZWQgID8gJ2lzLXNlbGVjdGVkJyA6ICcnKSArIGBcIiBpZD1cImAgKyBhbnN3ZXJzW2Fuc3dlcl0udXVpZCArIGBcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxpbnB1dCBjbGFzcz1cIm1yLTEgc3VydmV5LXF1ZXN0aW9uLWlucHV0XCIgdHlwZT1cImAgKyAodGhpcy5xdWVzdGlvbi5oYXNNdWx0aXBsZUFuc3dlcnMgPyAnY2hlY2tib3gnIDogJ3JhZGlvJykgKyBgXCIgbmFtZT1cImFuc3dlcnNbb3B0aW9uXVtgICsgdGhpcy5xdWVzdGlvbi51dWlkICsgYF1bXVwiXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBgICsgKGFuc3dlcnNbYW5zd2VyXS5pc1NlbGVjdGVkID8gJ2NoZWNrZWQ9XCJjaGVja2VkXCInIDogJycpICsgYCB2YWx1ZT1cImAgKyBhbnN3ZXJzW2Fuc3dlcl0udXVpZCArIGBcIiAvPiBgICsgYW5zd2Vyc1thbnN3ZXJdLnRpdGxlICsgYFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2xhYmVsPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PmA7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMucXVlc3Rpb24uYW5zd2Vyc1thbnN3ZXJdLmlzRnJlZUFuc3dlcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgaHRtbCArPSBgPHRleHRhcmVhIGNsYXNzPVwic3VydmV5LXF1ZXN0aW9uLWlucHV0XCI+PC90ZXh0YXJlYT5gO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGlzU2VsZWN0ZWRQYXJlbnQgPT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGh0bWwgKz0gYDxkaXYgY2xhc3M9XCJwbC00IGQtZmxleCBmbGV4LWNvbHVtblwiPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGxhYmVsIGNsYXNzPVwic3VydmV5LXF1ZXN0aW9uLW9wdGlvbiBgICsgKGFuc3dlcnNbYW5zd2VyXS5pc1NlbGVjdGVkID8gJ2lzLXNlbGVjdGVkJyA6ICcnKSArIGBcIiBpZD1cImAgKyBhbnN3ZXJzW2Fuc3dlcl0udXVpZCArIGBcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aW5wdXQgY2xhc3M9XCJtci0xIHN1cnZleS1xdWVzdGlvbi1pbnB1dFwiIHR5cGU9XCJjaGVja2JveFwiIG5hbWU9XCJhbnN3ZXJzW29wdGlvbl1bYCArIHRoaXMucXVlc3Rpb24udXVpZCArIGBdW11cIiAkeyhhbnN3ZXJzW2Fuc3dlcl0uaXNTZWxlY3RlZCA/ICdjaGVja2VkPVwiY2hlY2tlZFwiJyA6ICcnKX0gdmFsdWU9XCIke2Fuc3dlcnNbYW5zd2VyXS51dWlkfVwiIC8+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYCArIGFuc3dlcnNbYW5zd2VyXS50aXRsZSArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBgPC9sYWJlbD5gO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoYW5zd2Vyc1thbnN3ZXJdLmlzU2VsZWN0ZWQgJiYgdGhpcy5xdWVzdGlvbi5hbnN3ZXJzW2Fuc3dlcl0uaXNGcmVlQW5zd2VyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaHRtbCArPSBgPGxhYmVsIGNsYXNzPVwiYCArIChhbnN3ZXJzW2Fuc3dlcl0uaXNTZWxlY3RlZCA/ICdpcy1zZWxlY3RlZCcgOiAnJykgKyBgXCI+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHRleHRhcmVhIGNsYXNzPVwic3VydmV5LXF1ZXN0aW9uLWlucHV0IGQtYmxvY2tcIiBpZD1cInRleHRhcmVhLWAgKyB0aGlzLnF1ZXN0aW9uLmFuc3dlcnNbYW5zd2VyXS51dWlkICsgYF1cIj5gICsgdGhpcy5xdWVzdGlvbi5hbnN3ZXJzW2Fuc3dlcl0uZXhwbGFuYXRpb24gKyBgPC90ZXh0YXJlYT5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvbGFiZWw+YDtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgaHRtbCArPSAnPC9kaXY+JztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBodG1sICs9IGBcbiAgICAgICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICBgO1xuICAgICAgICB9KTtcblxuICAgICAgICB0aGlzLmVsU3VydmVheUZvcm0uaW5uZXJIVE1MID0gaHRtbDtcblxuICAgICAgICB0aGlzLmVsUHJvZ3Jlc3NCYXIuc3R5bGUud2lkdGggPSB0aGlzLnByb2dyZXNzLnBlcmNlbnRhZ2UgKyAnJSc7XG5cbiAgICAgICAgaWYgKHRoaXMucHJvZ3Jlc3MucGVyY2VudGFnZSA9PT0gMTAwKSB7XG4gICAgICAgICAgICB0aGlzLmVsU3VydmV5UG9sbEJ0bi5jbGFzc0xpc3QucmVtb3ZlKCdkaXNhYmxlZCcpO1xuICAgICAgICAgICAgJCh0aGlzLmVsU3VydmV5UG9sbEJ0bikucGFyZW50KCkudG9vbHRpcCgnZGlzYWJsZScpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5lbFN1cnZleVBvbGxCdG4uY2xhc3NMaXN0LmFkZCgnZGlzYWJsZWQnKTtcbiAgICAgICAgICAgICQodGhpcy5lbFN1cnZleVBvbGxCdG4pLnBhcmVudCgpLnRvb2x0aXAoJ2VuYWJsZScpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgc2V0TGF5ZXJEYXRhKGxheWVyLCBldikge1xuICAgICAgICB0aGlzLmxheWVyID0gbGF5ZXI7XG4gICAgICAgIHRoaXMuZXZlbnQgPSBldjtcbiAgICAgICAgdGhpcy5nZW9PYmplY3RVVUlEID0gdGhpcy5sYXllci5mZWF0dXJlLnByb3BlcnRpZXMuaWQ7XG4gICAgICAgIHRoaXMuZ2V0UXVlc3Rpb25zKCk7XG4gICAgICAgIHRoaXMuZ2V0UmVzdWx0cygpO1xuICAgIH1cblxuICAgIGFkZE1hcmtlcigpIHtcbiAgICAgICAgdGhpcy5yZW1vdmVNYXJrZXIoKTtcbiAgICAgICAgdGhpcy5tYXBNYXJrZXIgPSBMLm1hcmtlcih0aGlzLmxheWVyLmdldENlbnRlcigpLCB7XG4gICAgICAgICAgICBpY29uOiB0aGlzLm1hcE1hcmtlckljb25cbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMubWFwTWFya2VyLmFkZFRvKHRoaXMubWFwSW5zdGFuY2UubWFwKTtcbiAgICB9XG5cbiAgICByZW1vdmVNYXJrZXIoKSB7XG4gICAgICAgIGlmICh0aGlzLm1hcE1hcmtlcikge1xuICAgICAgICAgICAgdGhpcy5tYXBNYXJrZXIucmVtb3ZlKCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBvcGVuKGxheWVyLCBldikge1xuICAgICAgICB0aGlzLmlzT3BlbiA9IHRydWU7XG4gICAgICAgIHRoaXMubWFwSW5zdGFuY2UubWFwLmNsb3NlUG9wdXAoKTtcbiAgICAgICAgdGhpcy5tYXBJbnN0YW5jZS5zZXRMYXllckFjdGl2ZVN0eWxlKHRoaXMubGF5ZXIpO1xuICAgICAgICB0aGlzLm1hcEluc3RhbmNlLnRvZ2dsZUhlYWRlckVsKGZhbHNlKTtcbiAgICAgICAgdGhpcy5hZGRNYXJrZXIoKTtcblxuICAgICAgICBpZiAobGF5ZXIgJiYgZXYpIHtcbiAgICAgICAgICAgIHRoaXMuc2V0TGF5ZXJEYXRhKGxheWVyLCBldik7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmVsUGF0aFZvdGVTdXJ2ZXlDb250YWluZXIucXVlcnlTZWxlY3RvcignLmdlby1vYmplY3QtbmFtZScpLnRleHRDb250ZW50ID0gdGhpcy5sYXllci5mZWF0dXJlLnByb3BlcnRpZXMubmFtZTtcbiAgICAgICAgdGhpcy5lbFBhdGhWb3RlU3VydmV5Q29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoJy5nZW8tb2JqZWN0LXR5cGUnKS50ZXh0Q29udGVudCA9IHRoaXMubGF5ZXIuZmVhdHVyZS5wcm9wZXJ0aWVzLnR5cGU7XG4gICAgICAgIHRoaXMubWFwSW5zdGFuY2UuYWRkVG9BY3RpdmVBcmVhTGlzdCh0aGlzLmVsUGF0aFZvdGVTdXJ2ZXlDb250YWluZXIpO1xuICAgIH1cblxuICAgIGNsb3NlKCkge1xuICAgICAgICB0aGlzLmlzT3BlbiA9IGZhbHNlO1xuICAgICAgICB0aGlzLnJlbW92ZU1hcmtlcigpO1xuICAgICAgICB0aGlzLm1hcEluc3RhbmNlLnRvZ2dsZUhlYWRlckVsKHRydWUpO1xuICAgICAgICB0aGlzLm1hcEluc3RhbmNlLnJlbW92ZUZyb21BY3RpdmVBcmVhTGlzdCh0aGlzLmVsUGF0aFZvdGVTdXJ2ZXlDb250YWluZXIpO1xuICAgIH1cblxuICAgIGNsZWFyUXVlc3Rpb24odXVpZCkge1xuICAgICAgICAkLmFqYXgoe1xuICAgICAgICAgICAgdHlwZTogJ1BPU1QnLFxuICAgICAgICAgICAgdXJsOiAnL2dlby8nICsgdGhpcy5nZW9PYmplY3RVVUlEICsgJy9jbGVhci8nICsgdXVpZCxcbiAgICAgICAgICAgIHN1Y2Nlc3M6ICgpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmdldFF1ZXN0aW9ucygpO1xuICAgICAgICAgICAgICAgIHRoaXMuZ2V0UmVzdWx0cygpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG59O1xuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFBQTtBQUNBOzs7QUFDQTtBQThCQTtBQUFBO0FBQ0E7QUFEQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBbkJBO0FBQ0E7QUFGQTtBQW9CQTtBQWRBO0FBQ0E7QUFDQTtBQUhBO0FBQ0E7QUFlQTtBQUNBO0FBQ0E7QUFDQTtBQWJBO0FBQ0E7QUFDQTs7O0FBWUE7QUFDQTtBQUNBO0FBQ0E7OztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBRUE7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFGQTtBQURBO0FBQ0E7QUFNQTtBQUNBO0FBQ0E7QUFDQTtBQURBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBRUE7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUpBO0FBTUE7OztBQUVBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFKQTtBQU1BOzs7QUFFQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQVpBO0FBY0E7OztBQUVBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFXQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFXQTtBQUNBO0FBQ0E7QUFDQTtBQUVBOzs7QUFFQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQVVBO0FBQ0E7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUtBO0FBQ0E7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBREE7QUFHQTtBQUNBOzs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBRUE7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFOQTtBQVFBOzs7Ozs7QUFDQSIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///6\n")}]);